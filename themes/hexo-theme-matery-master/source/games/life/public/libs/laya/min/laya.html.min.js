!function(t){t.un,t.uns;var e=t.static,i=t.class,n=t.getset,h=(t.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),l=laya.utils.ClassUtils,s=(laya.events.Event,laya.utils.HTMLChar),r=laya.net.Loader,a=(laya.display.Node,laya.maths.Rectangle),o=laya.renders.Render,d=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),u=laya.utils.Stat,c=laya.display.Text,_=laya.resource.Texture,f=laya.net.URL,y=laya.utils.Utils,g=(i(p,"laya.html.utils.HTMLParse"),p.parse=function(t,e,i){e=(e="<root>"+(e=e.replace(/<br>/g,"<br/>"))+"</root>").replace(p.spacePattern,p.char255),e=y.parseXMLFromString(e),p._parseXML(t,e.childNodes[0].childNodes,i)},p._parseXML=function(t,e,i,n){var h,s,r,a=0,o=0;if(e.join||e.item)for(a=0,o=e.length;a<o;++a)p._parseXML(t,e[a],i,n);else if(3==e.nodeType)t instanceof laya.html.dom.HTMLDivElement?(null==e.nodeName&&(e.nodeName="#text"),s=e.nodeName.toLowerCase(),0<(r=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(h=l.getInstance(s))&&(t.addChild(h),h.innerTEXT=r.replace(p.char255AndOneSpacePattern," "))):0<(r=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(t.innerTEXT=r.replace(p.char255AndOneSpacePattern," "));else if("#comment"!=(s=e.nodeName.toLowerCase()))if(h=l.getInstance(s)){(h=t.addChild(h)).URI=i,h.href=n;var d=e.attributes;if(d&&0<d.length)for(a=0,o=d.length;a<o;++a){var u=(c=d[a]).nodeName,c=c.value;h._setAttributes(u,c)}p._parseXML(h,e.childNodes,i,h.href)}else p._parseXML(t,e.childNodes,i,n)},p.char255=String.fromCharCode(255),p.spacePattern=/&nbsp;|&#160;/g,p.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),p);function p(){}var m=(i(w,"laya.html.utils.Layout"),w.later=function(e){null==w._will&&(w._will=[],t.stage.frameLoop(1,null,(function(){if(!(w._will.length<1)){for(var t=0;t<w._will.length;t++)laya.html.utils.Layout.layout(w._will[t]);w._will.length=0}}))),w._will.push(e)},w.layout=function(t){if(!t||!t._style)return null;if(0==(512&t._style._type))return null;t.getStyle()._type&=-513;var e=w._multiLineLayout(t);return o.isConchApp&&t.layaoutCallNative&&t.layaoutCallNative(),e},w._multiLineLayout=function(t){if(c.RightToLeft)return w._multiLineLayout2(t);var e=new Array;t._addChildsToLayout(e);var i,n,h,l=0,s=e.length,r=t._getCSSStyle(),a=r.letterSpacing,o=r.leading,d=r.lineHeight,u=r._widthAuto()||!r.wordWrap,_=u?999999:t.width,f=(t.height,0),y=r.italic?r.fontSize/3:0,g=r._getAlign(),p=r._getValign(),m=0!==p||0!==g||0!=d,v=0,S=0,L=0,T=0,C=new Array,E=C[0]=new x,M=!1,H=!1;E.h=0,r.italic&&(_-=r.fontSize/3);var I=0,A=!0;function N(){E.y=S,S+=E.h+o,0==E.h&&(S+=d),E.mWidth=I,I=0,E=new x,C.push(E),E.h=0,M=!(A=!(v=0))}for(l=0;l<s;l++)if(null!=(i=e[l]))if(A=!1,i instanceof laya.html.dom.HTMLBrElement)N(),E.y=S;else{if(i._isChar()){if((h=i).isWord)M=H||"\n"===h.char,E.wordStartIndex=E.elements.length;else{if(0<C.length&&_<v+L&&0<E.wordStartIndex){var R=E.elements.length-E.wordStartIndex+1;E.elements.length=E.wordStartIndex,l-=R,N();continue}M=!1,I+=h.width}L=h.width+a,T=h.height,H=!1,(M=M||_<v+L)&&N(),E.minTextHeight=Math.min(E.minTextHeight,i.height)}else n=i._getCSSStyle(),R=i,h=n.padding,0===n._getCssFloat()||(m=!0),M=H||n.lineElement,L=R.width*R._style._tf.scaleX+h[1]+h[3]+a,T=R.height*R._style._tf.scaleY+h[0]+h[2],H=n.lineElement,(M=M||_<v+L&&n.wordWrap)&&N();E.elements.push(i),E.h=Math.max(E.h,T),i.x=v,i.y=S,v+=L,E.w=v-a,E.y=S,f=Math.max(v+y,f)}else A||(v+=w.DIV_ELEMENT_PADDING),E.wordStartIndex=E.elements.length;if(S=E.y+E.h,m){var W=0,U=_;for(u&&0<t.width&&(U=t.width),l=0,s=C.length;l<s;l++)C[l].updatePos(0,U,l,W,g,p,d),W+=Math.max(d,C[l].h+o);S=W}return u&&(t.width=f),S>t.height&&(t.height=S),[f,S]},w._multiLineLayout2=function(t){var e=new Array;t._addChildsToLayout(e);var i,n,h,l=0,s=e.length,r=t._getCSSStyle(),a=r.letterSpacing,o=r.leading,d=r.lineHeight,u=r._widthAuto()||!r.wordWrap,c=u?999999:t.width,_=(t.height,0),f=r.italic?r.fontSize/3:0,y=2-r._getAlign(),g=r._getValign(),p=0!==g||0!=y||0!=d,m=0,v=0,S=0,L=0,T=new Array,C=T[0]=new x,E=!1,M=!1;C.h=0,r.italic&&(c-=r.fontSize/3);var H=0,I=!0;function A(){C.y=v,v+=C.h+o,0==C.h&&(v+=d),C.mWidth=H,H=0,C=new x,T.push(C),C.h=0,E=!(I=!(m=0))}for(l=0;l<s;l++)if(null!=(i=e[l]))if(I=!1,i instanceof laya.html.dom.HTMLBrElement)A(),C.y=v;else{if(i._isChar()){if((h=i).isWord)E=M||"\n"===h.char,C.wordStartIndex=C.elements.length;else{if(0<T.length&&c<m+S&&0<C.wordStartIndex){var N=C.elements.length-C.wordStartIndex+1;C.elements.length=C.wordStartIndex,l-=N,A();continue}E=!1,H+=h.width}S=h.width+a,L=h.height,M=!1,(E=E||c<m+S)&&A(),C.minTextHeight=Math.min(C.minTextHeight,i.height)}else n=i._getCSSStyle(),N=i,h=n.padding,0===n._getCssFloat()||(p=!0),E=M||n.lineElement,S=N.width*N._style._tf.scaleX+h[1]+h[3]+a,L=N.height*N._style._tf.scaleY+h[0]+h[2],M=n.lineElement,(E=E||c<m+S&&n.wordWrap)&&A();C.elements.push(i),C.h=Math.max(C.h,L),i.x=m,i.y=v,m+=S,C.w=m-a,C.y=v,_=Math.max(m+f,_)}else I||(m+=w.DIV_ELEMENT_PADDING),C.wordStartIndex=C.elements.length;if(v=C.y+C.h,p){var R=0,W=c;for(l=0,s=T.length;l<s;l++)T[l].updatePos(0,W,l,R,y,g,d),R+=Math.max(d,T[l].h+o);v=R}for(u&&(t.width=_),v>t.height&&(t.height=v),l=0,s=T.length;l<s;l++)T[l].revertOrder(c);return[_,v]},w._will=null,w.DIV_ELEMENT_PADDING=0,w);function w(){}var x=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}i(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,h,l,s){var r=0;0<this.elements.length&&(r=(c=this.elements[this.elements.length-1]).x+c.width-this.elements[0].x);var a=0,o=NaN;1===h&&(a=(e-r)/2),2===h&&(a=e-r),0===s||0!=l||(l=1);for(var d=0,u=this.elements.length;d<u;d++){var c,_=(c=this.elements[d])._getCSSStyle();switch(0!==a&&(c.x+=a),_._getValign()){case 0:c.y=n;break;case 1:var f=0;f=((f=99999!=this.minTextHeight?this.minTextHeight:f)+s)/2,f=Math.max(f,this.h),laya.html.dom.HTMLImageElement,o=n+f-c.height,c.y=o;break;case 2:c.y=n+(s-c.height)}}},e.revertOrder=function(t){var e;if(0<this.elements.length){var i=0,n=this.elements.length;for(i=0;i<n;i++)(e=this.elements[i]).x=t-e.x-e.width}},t}(),v=function(e){function l(){this.URI=null,this._href=null,l.__super.call(this),this._text=l._EMPTYTEXT,this.setStyle(new h(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}i(l,"laya.html.dom.HTMLElement",e);var r=l.prototype;return r.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine,this.style.stroke,this.style.strokeColor):this.graphics.clear()},r.appendChild=function(t){return this.addChild(t)},r._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,h=0;if(this._text.drawWords)i=this._text.drawWords;else{for(h=(e=t.split(" ")).length-1,i=[],n=0;n<h;n++)i.push(e[n]," ");0<=h&&i.push(e[h]),this._text.drawWords=i}var l=this._text.words;if(l&&l.length===i.length)return l;null===l&&(this._text.words=l=[]),l.length=i.length;var r=this.style,a=r.font;for(n=0,h=i.length;n<h;n++){var o=y.measureText(i[n],a),u=l[n]=new s(i[n],o.width,o.height||r.fontSize,r);1<u.char.length&&(u.charNum=u.char),this.href&&(o=new d,this.addChild(o),u.setSprite(o))}return l},r._getWords=function(){if(!c.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e=this._text.words;if(e&&e.length===t.length)return e;null===e&&(this._text.words=e=[]),e.length=t.length;for(var i=this.style,n=i.font,h=0,l=t.length;h<l;h++){var r=y.measureText(t.charAt(h),n),a=e[h]=new s(t.charAt(h),r.width,r.height||i.fontSize,i);this.href&&(r=new d,this.addChild(r),a.setSprite(r))}return e},r.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],h=0;h<t.length;h++)i=t[h],(e=new d).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},r._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&t.block?(m.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},r._setAttributes=function(t,i){switch(t){case"style":return void this.style.cssText(i);case"class":return void(this.className=i)}e.prototype._setAttributes.call(this,t,i)},r.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},r.onLinkHandler=function(t){if("click"===t.type)for(var e=this;e;)e.event("link",[this.href]),e=e.parent},r.formatURL=function(t){return this.URI?f.formatURL(t,this.URI?this.URI.path:null):t},n(0,r,"href",(function(){return this._href}),(function(t){null!=(this._href=t)&&(this._getCSSStyle().underLine=1,this.updateHref())})),n(0,r,"color",null,(function(t){this.style.color=t})),n(0,r,"onClick",null,(function(e){t._runScript("fn=function(event){"+e+";}"),this.on("click",this,void 0)})),n(0,r,"id",null,(function(t){L.document.setElementById(t,this)})),n(0,r,"innerTEXT",(function(){return this._text.text}),(function(t){this.text=t})),n(0,r,"style",(function(){return this._style})),n(0,r,"text",(function(){return this._text.text}),(function(t){this._text==l._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),o.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()})),n(0,r,"parent",e.prototype._$get_parent,(function(e){var i;e instanceof laya.html.dom.HTMLElement&&(i=e,this.URI||(this.URI=i.URI),this.style.inherit(i.style)),t.superSet(d,this,"parent",e)})),n(0,r,"className",null,(function(t){this.style.attrs(L.document.styleSheets["."+t])})),l.fillWords=function(t,e,i,n,h,l,s,r,a){t.graphics.clear();for(var o=0,d=e.length;o<d;o++){var u=e[o];0<r?t.graphics.fillBorderText(u.char,u.x+i,u.y+n,h,l,a,r,"left"):t.graphics.fillText(u.char,u.x+i,u.y+n,h,l,"left",s)}},l._EMPTYTEXT={text:null,words:null},l}(d);i((function t(){t.__super.call(this),this.style.lineElement=!0,this.style.block=!0}),"laya.html.dom.HTMLBrElement",v);var S=function(e){function h(){this.contextHeight=NaN,this.contextWidth=NaN,h.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}i(h,"laya.html.dom.HTMLDivElement",e);var l=h.prototype;return l.appendHTML=function(t){g.parse(this,t,this.URI),this.layout()},l._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach((function(e){t.push(e)}));for(var i=!0,n=0,h=this._childs.length;n<h;n++){var l=this._childs[n];i?i=!1:t.push(null),l._addToLayout(t)}return!0},l._addToLayout=function(t){this.layout()},l.layout=function(){var t,e;this.style&&(this.style._type|=512,(t=m.layout(this))&&(this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new a),(e=this._$P.mHtmlBounds).x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)))},n(0,l,"height",(function(){return this._height||this.contextHeight}),e.prototype._$set_height),n(0,l,"innerHTML",null,(function(t){this.destroyChildren(),this.appendHTML(t)})),n(0,l,"width",(function(){return this._width||this.contextWidth}),(function(e){var i=0===e?e!=this._width:e!=this.width;t.superSet(v,this,"width",e),i&&this.layout()})),h}(v),L=function(){function t(){this.all=new Array,this.styleSheets=h.styleSheets,t.__super.call(this)}i(t,"laya.html.dom.HTMLDocument",v);var n=t.prototype;return n.getElementById=function(t){return this.all[t]},n.setElementById=function(t,e){this.all[t]=e},e(t,["document",function(){return this.document=new t}]),t}();(function(){function t(){this._tex=null,this._url=null,this._renderArgs=[],t.__super.call(this),this.style.block=!0}i(t,"laya.html.dom.HTMLImageElement",v);var e=t.prototype;e._addToLayout=function(t){this._style.absolute||t.push(this)},e.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(u.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},e.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},n(0,e,"src",null,(function(t){var e,i=this;function n(){var t;i._style&&((t=i._style).widthed(i)||i._tex.width,t.heighted(i)||i._tex.height,t.widthed(i)||i._width==i._tex.width||(i.width=i._tex.width,i.parent&&i.parent._layoutLater()),t.heighted(i)||i._height==i._tex.height||(i.height=i._tex.height,i.parent&&i.parent._layoutLater()),o.isConchApp&&(i._renderArgs[0]=i._tex,i._renderArgs[1]=i.x,i._renderArgs[2]=i.y,i._renderArgs[3]=i.width||i._tex.width,i._renderArgs[4]=i.height||i._tex.height,i.graphics.drawTexture(i._tex,0,0,i._renderArgs[3],i._renderArgs[4])),i.repaint(),i.parentRepaint())}t=this.formatURL(t),this._url!=t&&(this._url=t,(e=this._tex=r.getRes(t))||(this._tex=e=new _,e.load(t),r.cacheRes(t,e)),e.loaded?n():e.on("loaded",null,n))}))})(),function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}i(e,"laya.html.dom.HTMLLinkElement",t);var l=e.prototype;l._onload=function(t){"text/css"===this.type&&h.parseCSS(t,this.URI)},n(0,l,"href",t.prototype._$get_href,(function(t){var e=this;t=this.formatURL(t),this.URI=new f(t);var i=new r;i.once("complete",null,(function(t){e._onload(t)})),i.load(t,"text")})),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(v),function(t){function e(){e.__super.call(this),this.visible=!1}i(e,"laya.html.dom.HTMLStyleElement",t);var l=e.prototype;n(0,l,"text",t.prototype._$get_text,(function(t){h.parseCSS(t,null)}))}(v),function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}i(e,"laya.html.dom.HTMLIframeElement",t);var h=e.prototype;n(0,h,"href",t.prototype._$get_href,(function(t){var e=this;t=this.formatURL(t);var i=new r;i.once("complete",null,(function(i){var n=e.URI;e.URI=new f(t),e.innerHTML=i,n&&(e.URI=n)})),i.load(t,"text")}))}(S)}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],(function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}));