!function(i,e,n){n.un,n.uns;var t=n.static,o=n.class,a=n.getset,l=(n.__newvec,laya.utils.Browser),s=n.Config,r=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,d=laya.utils.Handler,c=laya.display.Input,f=laya.net.Loader,h=laya.net.LocalStorage,v=(laya.maths.Matrix,laya.renders.Render),p=laya.net.ResourceVersion,m=laya.utils.RunDriver,y=laya.media.SoundChannel,_=laya.media.SoundManager,g=laya.net.URL,w=laya.utils.Utils,E=function(){function i(){}return o(i,"laya.tbplugin.mini.MiniFileMgr",null,"MiniFileMgr$11"),i.isLocalNativeFile=function(i){for(var e=0,n=L.nativefiles.length;e<n;e++)if(-1!=i.indexOf(L.nativefiles[e]))return!0;return!1},i.getFileInfo=function(e){var n=e,t=i.fakeObj[n];return null==t?null:t},i.read=function(e,n,t,o,a,l){var s;void 0===n&&(n="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===l&&(l=""),s=""==o||-1==o.indexOf("http://")&&-1==o.indexOf("https://")?e:i.getFileNativePath(e),i.fs.readFile({filePath:s,encoding:n,success:function(i){null!=t&&t.runWith([0,i])},fail:function(e){e&&""!=o?i.downFiles(o,n,t,o,a,l):null!=t&&t.runWith([1])}})},i.downFiles=function(e,n,t,o,a,l,s){void 0===n&&(n="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===l&&(l=""),void 0===s&&(s=!0),i.wxdown({url:e,success:function(r){r.hasOwnProperty("statusCode")||(r.statusCode=200),200===r.statusCode?i.readFile(r.apFilePath,n,t,o,a,l,s):403===r.statusCode?null!=t&&t.runWith([0,e]):null!=t&&t.runWith([1,r])},fail:function(i){null!=t&&t.runWith([1,i])}})},i.readFile=function(e,n,t,o,a,l,s){void 0===n&&(n="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===l&&(l=""),void 0===s&&(s=!0),i.fs.readFile({filePath:e,encoding:n,success:function(l){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||!a?null!=t&&t.runWith([0,l]):(null!=t&&t.runWith([0,l]),i.copyFile(e,o,null,n,s))},fail:function(i){i&&null!=t&&t.runWith([1,i])}})},i.downOtherFiles=function(e,n,t,o,a){void 0===t&&(t=""),void 0===o&&(o=!1),void 0===a&&(a=!0),i.wxdown({url:e,success:function(e){e.hasOwnProperty("statusCode")||(e.statusCode=200),200===e.statusCode?o&&-1==t.indexOf(".php")?(null!=n&&n.runWith([0,e.apFilePath]),i.copyFile(e.apFilePath,t,null,"",a)):null!=n&&n.runWith([0,e.apFilePath]):null!=n&&n.runWith([1,e])},fail:function(i){null!=n&&n.runWith([1,i])}})},i.downLoadFile=function(e,t,o,a,s){void 0===t&&(t=""),void 0===a&&(a="utf8"),void 0===s&&(s=!1),l.window.hasOwnProperty("my")?n.loader.load(e,o):"image"==t||"sound"==t?i.downOtherFiles(e,o,e,s,!1):i.downFiles(e,a,o,e,!0,t,s)},i.copyFile=function(e,n,t,o,a){void 0===o&&(o=""),void 0===a&&(a=!0);var s=e.split("/"),r=s[s.length-1],u=i.getFileInfo(n),d=i.getFileNativePath(r);i.fakeObj[n]={md5:r,readyUrl:n,size:0,times:l.now(),encoding:o};var c=52428800,f=4194304,h=i.getCacheUseSize();u?u.readyUrl!=n?i.fs.getFileInfo({filePath:e,success:function(l){a&&h+f+l.size>=c&&(l.size>L.minClearSize&&(L.minClearSize=l.size),i.onClearCacheRes()),i.deleteFile(e,n,t,o,l.size)},fail:function(i){null!=t&&t.runWith([1,i])}}):null!=t&&t.runWith([0]):i.fs.getFileInfo({filePath:e,success:function(l){a&&h+f+l.size>=c&&(l.size>L.minClearSize&&(L.minClearSize=l.size),i.onClearCacheRes()),i.fs.copyFile({srcPath:e,destPath:d,success:function(e){i.onSaveFile(n,r,!0,o,t,l.size)},fail:function(i){null!=t&&t.runWith([1,i])}})},fail:function(i){null!=t&&t.runWith([1,i])}})},i.onClearCacheRes=function(){var e=L.minClearSize,n=[];for(var t in i.filesListObj)"fileUsedSize"!=t&&n.push(i.filesListObj[t]);i.sortOn(n,"times",16);for(var o=0,a=1,l=n.length;a<l;a++){var s=n[a];if(o>=e)break;o+=s.size,i.deleteFile("",s.readyUrl)}},i.sortOn=function(i,e,n){return void 0===n&&(n=0),16==n?i.sort((function(i,n){return i[e]-n[e]})):18==n?i.sort((function(i,n){return n[e]-i[e]})):i.sort((function(i,n){return i[e]-n[e]}))},i.getFileNativePath=function(i){return laya.tbplugin.mini.MiniFileMgr.fileNativeDir+"/"+i},i.deleteFile=function(e,n,t,o,a){void 0===n&&(n=""),void 0===o&&(o=""),void 0===a&&(a=0);var l=i.getFileInfo(n),s=i.getFileNativePath(l.md5);i.fs.unlink({filePath:s,success:function(l){var s=""!=e;if(""!=e){var r=i.getFileNativePath(e);i.fs.copyFile({srcPath:e,destPath:r,success:function(a){i.onSaveFile(n,e,s,o,t,a.size)},fail:function(i){null!=t&&t.runWith([1,i])}})}else i.onSaveFile(n,e,s,o,t,a)},fail:function(i){}})},i.deleteAll=function(){var e=[];for(var n in i.filesListObj)"fileUsedSize"!=n&&e.push(i.filesListObj[n]);for(var t=1,o=e.length;t<o;t++){var a=e[t];i.deleteFile("",a.readyUrl)}laya.tbplugin.mini.MiniFileMgr.filesListObj&&laya.tbplugin.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.tbplugin.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.tbplugin.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},i.onSaveFile=function(e,n,t,o,a,s){void 0===t&&(t=!0),void 0===o&&(o=""),void 0===s&&(s=0);var r=e;if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),t)i.getFileNativePath(n),i.filesListObj[r]={md5:n,readyUrl:e,size:s,times:l.now(),encoding:o},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+s,i.writeFilesList(r,JSON.stringify(i.filesListObj),!0),null!=a&&a.runWith([0]);else if(i.filesListObj[r]){var u=parseInt(i.filesListObj[r].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-u,i.filesListObj[r].md5==i.fakeObj[r].md5&&delete i.fakeObj[r],delete i.filesListObj[r],i.writeFilesList(r,JSON.stringify(i.filesListObj),!1),null!=a&&a.runWith([0])}},i.writeFilesList=function(e,n,t){var o=i.fileNativeDir+"/"+i.fileListName;i.fs.writeFile({filePath:o,encoding:"utf8",data:n,success:function(i){},fail:function(i){}}),!L.isZiYu&&L.isPosMsgYu&&L.window.my.postMessage&&L.window.my.postMessage({url:e,data:i.filesListObj[e],isLoad:"filenative",isAdd:t})},i.getCacheUseSize=function(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0},i.existDir=function(e,n){i.fs.mkdir({dirPath:e,success:function(i){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(e){10025==e.error?i.readSync(i.fileListName,"utf8",n):null!=n&&n.runWith([1,e])}})},i.readSync=function(e,n,t,o){void 0===n&&(n="utf8"),void 0===o&&(o="");var a,l=i.getFileNativePath(e);try{i.fs.readFile({filePath:l,encoding:n,success:function(i){a=i.data,null!=t&&t.runWith([0,{data:a}])},fail:function(){null!=t&&t.runWith([1])}})}catch(i){null!=t&&t.runWith([1])}},i.setNativeFileDir=function(e){i.fileNativeDir=L.window.my.env.USER_DATA_PATH+e},i.filesListObj={},i.fakeObj={},i.fileNativeDir=null,i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16,t(i,["fs",function(){return this.fs=L.window.my.getFileSystemManager()},"wxdown",function(){return this.wxdown=L.window.my.downloadFile}]),i}(),F=function(){function i(){}return o(i,"laya.tbplugin.mini.MiniImage",null,"MiniImage$11"),i.prototype._loadImage=function(e){var n=this;if(e=g.formatURL(e),E.isLocalNativeFile(e)||-1==e.indexOf("http://")&&-1==e.indexOf("https://"))if(-1!=e.indexOf(L.window.my.env.USER_DATA_PATH))i.onCreateImage(e,n,!1,e);else{if(""!=E.loadPath)e=e.split(E.loadPath)[1];else{var t=""!=g.rootPath?g.rootPath:g.basePath,o=e;""!=t&&(e=e.split(t)[1]),e||(e=o)}i.onCreateImage(e,n,!0)}else i.onCreateImage(e,n,!1,encodeURI(e))},i.onCreateImage=function(i,e,n,t){var o,a;function s(){a.onload=null,a.onerror=null,delete e.imgCache[i]}void 0===n&&(n=!1),void 0===t&&(t=""),o=n?L.baseDir+i:""!=t?t:i,null==e.imgCache&&(e.imgCache={});var r=function(){s(),e.onLoaded(a)},d=function(){s(),delete E.filesListObj[i],delete E.fakeObj[i],e.event("error","Load image failed")};"nativeimage"==e._type?((a=new l.window.Image).crossOrigin="",a.onload=r,a.onerror=d,a.src=o,e.imgCache[i]=a):new u.create(o,{onload:r,onerror:d,onCreate:function(n){a=n,e.imgCache[i]=n}})},i}(),C=function(){function i(){}return o(i,"laya.tbplugin.mini.MiniInput",null,"MiniInput$11"),i._createInputElement=function(){c._initInput(c.area=l.createElement("textarea")),c._initInput(c.input=l.createElement("input")),c.inputContainer=l.createElement("div"),c.inputContainer.style.position="absolute",c.inputContainer.style.zIndex=1e5,l.container.appendChild(c.inputContainer),c.inputContainer.setPos=function(i,e){c.inputContainer.style.left=i+"px",c.inputContainer.style.top=e+"px"},_._soundClass=O,_._musicClass=O;var i=L.systemInfo.model,e=L.systemInfo.system;-1!=i.indexOf("iPhone")&&(l.onIPhone=!0,l.onIOS=!0,l.onIPad=!0,l.onAndroid=!1),-1==e.indexOf("Android")&&-1==e.indexOf("Adr")||(l.onAndroid=!0,l.onIPhone=!1,l.onIOS=!1,l.onIPad=!1)},i._onStageResize=function(){n.stage._canvasTransform.identity().scale(l.width/v.canvas.width/m.getPixelRatio(),l.height/v.canvas.height/m.getPixelRatio())},i.wxinputFocus=function(i){},i.inputEnter=function(i){},i.wxinputblur=function(){},i.hideKeyboard=function(){},i}(),b=function(){function i(){}return o(i,"laya.tbplugin.mini.MiniLocalStorage",null,"MiniLocalStorage$10"),i.__init__=function(){i.items=i},i.setItem=function(i,e){try{L.window.my.setStorageSync({key:i,data:e})}catch(n){L.window.my.setStorage({key:i,data:e})}},i.getItem=function(i){var e=L.window.my.getStorageSync({key:i});return e.success?e.data:null},i.setJSON=function(e,n){i.setItem(e,n)},i.getJSON=function(e){return i.getItem(e)},i.removeItem=function(i){L.window.my.removeStorageSync(i)},i.clear=function(){L.window.my.clearStorageSync()},i.getStorageInfoSync=function(){try{var i=L.window.my.getStorageInfoSync();return console.log(i.keys),console.log(i.currentSize),console.log(i.limitSize),i}catch(i){}return null},i.support=!0,i.items=null,i}(),L=(function(){function i(){}o(i,"laya.tbplugin.mini.MiniLocation",null,"MiniLocation$11"),i.__init__=function(){L.window.navigator.geolocation.getCurrentPosition=i.getCurrentPosition,L.window.navigator.geolocation.watchPosition=i.watchPosition,L.window.navigator.geolocation.clearWatch=i.clearWatch},i.getCurrentPosition=function(i,e,n){var t;(t={}).success=function(e){null!=i&&i(e)},t.fail=e,L.window.my.getLocation(t)},i.watchPosition=function(e,t,o){var a;return i._curID++,(a={}).success=e,a.error=t,i._watchDic[i._curID]=a,n.timer.loop(1e3,null,i._myLoop),i._curID},i.clearWatch=function(e){delete i._watchDic[e],i._hasWatch()||n.timer.clear(null,i._myLoop)},i._hasWatch=function(){var e;for(e in i._watchDic)if(i._watchDic[e])return!0;return!1},i._myLoop=function(){i.getCurrentPosition(i._mySuccess,i._myError)},i._mySuccess=function(e){var n,t={};for(n in t.coords=e,t.timestamp=l.now(),i._watchDic)i._watchDic[n].success&&i._watchDic[n].success(t)},i._myError=function(e){var n;for(n in i._watchDic)i._watchDic[n].error&&i._watchDic[n].error(e)},i._watchDic={},i._curID=0}(),function(){function i(i,e){this.videoend=!1,this.videourl="",this.videoElement=null,this.onPlayFunc=null,this.onEndedFunC=null,this._duration=NaN,this.position=NaN,void 0===i&&(i=320),void 0===e&&(e=240),this.videoElement=L.window.my.createVideo({width:i,height:e,autoplay:!0})}o(i,"laya.tbplugin.mini.MiniVideo",null,"MiniVideo$9");var e=i.prototype;e.on=function(i,e,n){"loadedmetadata"==i?(this.onPlayFunc=n.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=n.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},e.onTimeUpdateFunc=function(i){this.position=i.position,this._duration=i.duration},e.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()},e.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())},e.off=function(i,e,n){"loadedmetadata"==i?(this.onPlayFunc=n.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=n.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},e.load=function(i){this.videoElement&&(this.videoElement.src=i)},e.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},e.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},e.size=function(i,e){this.videoElement&&(this.videoElement.width=i,this.videoElement.height=e)},e.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},e.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},a(0,e,"duration",(function(){return this._duration})),a(0,e,"paused",(function(){return!!this.videoElement&&this.videoElement.paused})),a(0,e,"loop",(function(){return!!this.videoElement&&this.videoElement.loop}),(function(i){this.videoElement&&(this.videoElement.loop=i)})),a(0,e,"currentTime",(function(){return this.videoElement?this.videoElement.initialTime:0}),(function(i){this.videoElement&&(this.videoElement.initialTime=i)})),a(0,e,"ended",(function(){return this.videoend})),a(0,e,"muted",(function(){return!!this.videoElement&&this.videoElement.muted}),(function(i){this.videoElement&&(this.videoElement.muted=i)})),a(0,e,"videoWidth",(function(){return this.videoElement?this.videoElement.width:0})),a(0,e,"videoHeight",(function(){return this.videoElement?this.videoElement.height:0})),a(0,e,"playbackRate",(function(){return this.videoElement?this.videoElement.playbackRate:0}),(function(i){this.videoElement&&(this.videoElement.playbackRate=i)})),a(0,e,"x",(function(){return this.videoElement?this.videoElement.x:0}),(function(i){this.videoElement&&(this.videoElement.x=i)})),a(0,e,"y",(function(){return this.videoElement?this.videoElement.y:0}),(function(i){this.videoElement&&(this.videoElement.y=i)})),a(0,e,"currentSrc",(function(){return this.videoElement.src})),i.__init__=function(){laya.device.media.Video=i}}(),function(){function e(){}return o(e,"laya.tbplugin.mini.TBPluginAdapter"),e.getJson=function(i){return JSON.parse(i)},e.init=function(){if(!e._inited){e._inited=!0,e.window=i;var t=e.window.navigator.userAgent;(t.indexOf("TB")>-1||t.indexOf("Taobao")>-1||t.indexOf("TM/")>-1)&&(e.EnvConfig={},E.setNativeFileDir("/layaairGame"),E.existDir(E.fileNativeDir,d.create(e,e.onMkdirCallBack)),e.systemInfo=e.window.my.getSystemInfoSync(),e.window.focus=function(){},n._getUrlPath=function(){},n.getUrlPath=function(){},e.window.logtime=function(i){},e.window.alertTimeLog=function(i){},e.window.resetShareInfo=function(){},e._preCreateElement=l.createElement,l.createElement=e.createElement,e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e._preCreateElement("canvas").getContext("2d").__proto__,e.window.document.body.appendChild=function(){},m.createShaderCondition=e.createShaderCondition,w.parseXMLFromString=e.parseXMLFromString,c._createInputElement=C._createInputElement,e.EnvConfig.load=f.prototype.load,f.prototype.load=S.prototype.load,f.prototype._loadImage=F.prototype._loadImage,h._baseClass=b,b.__init__(),s.useRetinalCanvas=!0)}},e.measureText=function(i){var n=e._measureText(i);return n||(n={width:16},console.warn("-------微信获取文字宽度失败----等待修复---------")),n},e.getUrlEncode=function(i,e){return"arraybuffer"==e?"":"utf8"},e.downLoadFile=function(i,e,n,t){void 0===e&&(e=""),void 0===t&&(t="utf8"),E.getFileInfo(i)?null!=n&&n.runWith([0]):E.downLoadFile(i,e,n,t)},e.remove=function(i,e){E.deleteFile("",i,e,"",0)},e.removeAll=function(){E.deleteAll()},e.hasNativeFile=function(i){return E.isLocalNativeFile(i)},e.getFileInfo=function(i){return E.getFileInfo(i)},e.getFileList=function(){return E.filesListObj},e.exitMiniProgram=function(){e.window.my.exitMiniProgram()},e.onMkdirCallBack=function(i,e){i||(E.filesListObj=JSON.parse(e.data),E.fakeObj=JSON.parse(e.data))},e.pixelRatio=function(){if(!e.EnvConfig.pixelRatioInt)try{return e.EnvConfig.pixelRatioInt=e.systemInfo.pixelRatio,e.systemInfo.pixelRatio}catch(i){}return e.EnvConfig.pixelRatioInt},e.createElement=function(i){if("canvas"==i){var n;if(1==e.idx){if(n=e.window.canvas.getRealCanvas(),!e.window.my.isIDE){var t=n.getContext;n.getContext=function(i){var e=t.apply(n,[i]);return e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e}}}else n=e._preCreateElement(i);return!n.style&&(n.style={}),e.idx++,n}if("textarea"==i||"input"==i)return e.onCreateInput(i);if("div"==i){var o=e._preCreateElement(i);return o.contains=function(i){return null},o.removeChild=function(i){},o}return e._preCreateElement(i)},e.onCreateInput=function(i){var n=e._preCreateElement(i);return n.focus=C.wxinputFocus,n.blur=C.wxinputblur,n.value=0,n.placeholder={},n.type={},n.setColor=function(i){},n.setType=function(i){},n.setFontFace=function(i){},n.contains=function(i){return null},n},e.createShaderCondition=function(i){var e=this;return function(){return e[i.replace("this.","")]}},e.EnvConfig=null,e.window=null,e._preCreateElement=null,e._inited=!1,e.systemInfo=null,e.isPosMsgYu=!1,e.autoCacheFile=!1,e.minClearSize=5242880,e.AutoCacheDownFile=!1,e.baseDir="component/",e._measureText=null,e.parseXMLFromString=function(e){var n;e=e.replace(/>\s+</g,"><");try{n=(new i.Parser.DOMParser).parseFromString(e,"text/xml")}catch(i){throw"需要引入xml解析库文件"}return n},e.idx=1,t(e,["nativefiles",function(){return this.nativefiles=["layaNativeDir"]}]),e}()),S=(function(i){function e(){e.__super.call(this)}o(e,"laya.tbplugin.mini.MiniAccelerator",i,"MiniAccelerator$11");var n=e.prototype;n.on=function(n,t,o,a){return i.prototype.on.call(this,n,t,o,a),e.startListen(this.onDeviceOrientationChange),this},n.off=function(n,t,o,a){return void 0===a&&(a=!1),this.hasListener(n)||e.stopListen(),i.prototype.off.call(this,n,t,o,a)},e.__init__=function(){try{var i;if(!(i=laya.device.motion.Accelerator))return;i.prototype.on=e.prototype.on,i.prototype.off=e.prototype.off}catch(i){}},e.startListen=function(i){if(e._callBack=i,!e._isListening){e._isListening=!0;try{L.window.my.onAccelerometerChange(laya.tbplugin.mini.MiniAccelerator.onAccelerometerChange)}catch(i){}}},e.stopListen=function(){e._isListening=!1;try{L.window.my.stopAccelerometer({})}catch(i){}},e.onAccelerometerChange=function(i){var n;(n={}).acceleration=i,n.accelerationIncludingGravity=i,n.rotationRate={},null!=e._callBack&&e._callBack(n)},e._isListening=!1,e._callBack=null}(r),function(i){function e(){e.__super.call(this)}return o(e,"laya.tbplugin.mini.MiniLoader",i,"MiniLoader$11"),e.prototype.load=function(i,n,t,o,a){void 0===t&&(t=!0),void 0===a&&(a=!1);var l=this;if(l._url=i,0===i.indexOf("data:image")?l._type=n="image":l._type=n||(n=l.getTypeFromUrl(i)),l._cache=t,l._data=null,!a&&f.loadedMap[g.formatURL(i)])return l._data=f.loadedMap[g.formatURL(i)],this.event("progress",1),void this.event("complete",l._data);if(null!=f.parserMap[n])return l._customParse=!0,void(f.parserMap[n]instanceof laya.utils.Handler?f.parserMap[n].runWith(this):f.parserMap[n].call(null,this));var s=L.getUrlEncode(i,n),r=w.getFileExtension(i);if(-1!=e._fileTypeArr.indexOf(r)||"image"==n)L.EnvConfig.load.call(this,i,n,t,o,a);else if(E.getFileInfo(i)){var u=E.getFileInfo(g.formatURL(i));u.encoding=null==u.encoding?"utf8":u.encoding;var c=E.getFileNativePath(u.md5);E.readFile(c,u.encoding,new d(e,e.onReadNativeCallBack,[s,i,n,t,o,a,l]),i)}else{if(E.isLocalNativeFile(i)){if(L.subNativeFiles&&0==L.subNativeheads.length)for(var h in L.subNativeFiles){var v=L.subNativeFiles[h];L.subNativeheads=L.subNativeheads.concat(v);for(var m=0;m<v.length;m++)L.subMaps[v[m]]=h+"/"+v[m]}if(L.subNativeFiles&&-1!=i.indexOf("/")){var y=i.split("/")[0]+"/";if(y&&-1!=L.subNativeheads.indexOf(y)){var _=L.subMaps[y];i=i.replace(y,_)}}return void E.readFile(L.baseDir+p.addVersionPrefix(i),s,new d(e,e.onReadNativeCallBack,[s,i,n,t,o,a,l]))}g.formatURL(i),(u=E.getFileInfo(i))?(u.encoding=null==u.encoding?"utf8":u.encoding,E.readFile(u.url,s,new d(e,e.onReadNativeCallBack,[s,i,n,t,o,a,l]),i)):"image"==l.type||"htmlimage"==l.type?L.EnvConfig.load.call(l,i,n,t,o,a):(i=g.formatURL(i),"image"!=n&&(-1==i.indexOf("http://")&&-1==i.indexOf("https://")||E.isLocalNativeFile(i))?E.readFile(L.baseDir+i,s,new d(e,e.onReadNativeCallBack,[s,i,n,t,o,a,l]),i):E.downFiles(encodeURI(i),s,new d(e,e.onReadNativeCallBack,[s,i,n,t,o,a,l]),i,L.AutoCacheDownFile))}},e.onReadNativeCallBack=function(i,e,n,t,o,a,l,s,r){var u;void 0===t&&(t=!0),void 0===a&&(a=!1),void 0===s&&(s=0),s?1==s&&l.onError&&l.onError(r):(u="json"==n||"atlas"==n?L.getJson(r.data):"xml"==n?w.parseXMLFromString(r.data):r.data,l.onLoaded(u))},t(e,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e}(r)),O=function(i){function e(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,e.__super.call(this),this._sound=e._createSound()}o(e,"laya.tbplugin.mini.MiniSound",i,"MiniSound$11");var n=e.prototype;return n.load=function(i){this.event("error","Not support play sound")},n.onDownLoadCallBack=function(i,e,n){var t;if(void 0===n&&(n=""),!e&&this._sound)if(L.autoCacheFile){if(""==n)if(E.isLocalNativeFile(i)){var o=""!=g.rootPath?g.rootPath:g._basePath,a=i;""==o||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(t=i.split(o)[1]),t||(t=a),t=L.baseDir+t}else{var l=E.getFileInfo(i);if(l&&l.md5){var s=l.md5;t=E.getFileNativePath(s)}else t=-1==i.indexOf("http://")&&-1==i.indexOf("https://")&&-1==i.indexOf(L.window.my.env.USER_DATA_PATH)?L.baseDir+i:i}else t=n;this._sound.src=this.url=t}else(E.isLocalNativeFile(i)||-1==i.indexOf("http://")&&-1==i.indexOf("https://")&&-1==i.indexOf(L.window.my.env.USER_DATA_PATH))&&(i=L.baseDir+i),this._sound.src=i;else this.event("error")},n.play=function(i,e){return void 0===i&&(i=0),void 0===e&&(e=0),null},n.dispose=function(){this._sound&&(this._sound.src="",e._audioCache.push(this._sound),this._sound=null,this.readyUrl=this.url=null)},a(0,n,"duration",(function(){return this._sound.duration})),e._createSound=function(){return null},e._id=0,e._audioCache=[],e}(r);!function(i){function e(i){this._audio=null,this._onEnd=null,this._onCanplay=null,this._onError=null,this._miniSound=null,e.__super.call(this),this._audio=i._sound,this._miniSound=i,this._onEnd=e.bindToThis(this.__onEnd,this),this._onCanplay=e.bindToThis(this.onCanPlay,this),this._onError=e.bindToThis(this.onError,this),this.addEventListener()}o(e,"laya.tbplugin.mini.MiniSoundChannel",i,"MiniSoundChannel$11");var t=e.prototype;t.addEventListener=function(){this._audio.onError(this._onError),this._audio.onCanplay(this._onCanplay)},t.offEventListener=function(){this._audio.offError(this._onError),this._audio.offCanplay(this._onCanplay),this._audio.offEnded(this._onEnd)},t.onError=function(i){console.log("-----1---------------minisound-----url:",this.url),console.log(i),this.event("error"),this._audio&&(this._miniSound.dispose(),this.offEventListener(),this._audio=this._miniSound=null)},t.onCanPlay=function(){this._audio&&(this.event("complete"),this.offEventListener(),this._audio.onEnded(this._onEnd),this.isStopped?this.stop():this.play())},t.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(n.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},t.play=function(){this.isStopped=!1,_.addChannel(this),this._audio&&this._audio.play()},t.stop=function(){i.prototype.stop.call(this),this.isStopped=!0,_.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this.offEventListener(),this._miniSound.dispose(),this._miniSound=null,this._audio=null))},t.pause=function(){this.isStopped=!0,this._audio&&this._audio.pause()},t.resume=function(){this._audio&&(this.isStopped=!1,_.addChannel(this),this._audio.play())},a(0,t,"startTime",(function(){return this._audio?this._audio.startTime:0}),(function(i){this._audio&&(this._audio.startTime=i)})),a(0,t,"autoplay",(function(){return!!this._audio&&this._audio.autoplay}),(function(i){this._audio&&(this._audio.autoplay=i)})),a(0,t,"duration",(function(){return this._audio?this._audio.duration:0})),a(0,t,"position",(function(){return this._audio?this._audio.currentTime:0})),a(0,t,"loop",(function(){return!!this._audio&&this._audio.loop}),(function(i){this._audio&&(this._audio.loop=i)})),a(0,t,"volume",(function(){return this._audio?this._audio.volume:1}),(function(i){this._audio&&(this._audio.volume=i)})),e.bindToThis=function(i,e){return i.bind(e)}}(y)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],(function(i,e){"use strict";for(var n in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var t=Laya[n];t&&t.__isclass&&(e[n]=t)}}));