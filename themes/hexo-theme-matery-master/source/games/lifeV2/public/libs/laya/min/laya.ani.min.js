!function(t){t.un,t.uns;var e=t.static,i=t.class,a=t.getset,s=t.__newvec,r=laya.maths.Bezier,n=laya.utils.Browser,h=laya.utils.Byte,l=(laya.events.Event,laya.events.EventDispatcher),o=laya.display.Graphics,u=laya.resource.HTMLCanvas,c=laya.utils.Handler,d=laya.net.Loader,_=laya.maths.MathUtil,p=laya.maths.Matrix,f=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),m=laya.renders.Render,y=(laya.renders.RenderContext,laya.resource.Resource),x=laya.utils.RunDriver,g=(laya.media.SoundChannel,laya.media.SoundManager),v=laya.display.Sprite,D=laya.utils.Stat,M=laya.resource.Texture,I=(laya.net.URL,laya.utils.Utils),b=(i(A,"laya.ani.AnimationContent"),A);function A(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}var N=(i(T,"laya.ani.AnimationNodeContent"),T);function T(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}var C=(i(S,"laya.ani.AnimationParser01"),S.parse=function(t,e){var i=e.__getBuffer(),a=0,s=0,r=0,n=0,l=0,o=0,u=0,c=e.readUTFString();t._aniClassName=c;var d,_=e.readUTFString().split("\n"),p=e.getUint8(),f=e.getUint32();c=e.getUint32(),0<f&&(d=i.slice(f,c));var m=new h(d);for(0<c&&(t._publicExtData=i.slice(c,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=p,a=0;a<p;a++){var y=t._anis[a]=new b;y.nodes=new Array;var x=y.name=_[e.getUint16()];t._aniMap[x]=a,y.bone3DMap={},y.playTime=e.getFloat32();var g=y.nodes.length=e.getUint8();for(s=y.totalKeyframeDatasLength=0;s<g;s++){var v=y.nodes[s]=new N;v.childs=[],0<=(I=e.getInt16())&&(v.name=_[I],y.bone3DMap[v.name]=s),v.keyFrame=new Array,v.parentIndex=e.getInt16(),-1==v.parentIndex?v.parent=null:v.parent=y.nodes[v.parentIndex],v.lerpType=e.getUint8(),I=e.getUint32(),m.pos=I;var D=v.keyframeWidth=m.getUint16();if(y.totalKeyframeDatasLength+=D,0===v.lerpType||1===v.lerpType)for(v.interpolationMethod=[],v.interpolationMethod.length=D,r=0;r<D;r++)v.interpolationMethod[r]=Dt.interpolation[m.getUint8()];null!=v.parent&&v.parent.childs.push(v),0<(I=e.getUint16())&&(v.extenData=i.slice(e.pos,e.pos+I),e.pos+=I);var M,I=e.getUint16(),A=0;for(r=0,n=v.keyFrame.length=I;r<n;r++){if((M=v.keyFrame[r]=new _t).duration=e.getFloat32(),M.startTime=A,2===v.lerpType){M.interpolationData=[];var T,C=e.getUint8();switch(T=e.getFloat32()){case 254:for(M.interpolationData.length=D,u=0;u<D;u++)M.interpolationData[u]=0;break;case 255:for(M.interpolationData.length=D,u=0;u<D;u++)M.interpolationData[u]=5;break;default:for(M.interpolationData.push(T),o=1;o<C;o++)M.interpolationData.push(e.getFloat32())}}for(M.data=new Float32Array(D),l=0;l<D;l++)M.data[l]=e.getFloat32(),-1e-8<M.data[l]&&M.data[l]<1e-8&&(M.data[l]=0);A+=M.duration}M.startTime=y.playTime,v.playTime=y.playTime,t._calculateKeyFrame(v,I,D)}}},S);function S(){}var w=(i(F,"laya.ani.AnimationParser02"),F.READ_DATA=function(){F._DATA.offset=F._reader.getUint32(),F._DATA.size=F._reader.getUint32()},F.READ_BLOCK=function(){for(var t=F._BLOCK.count=F._reader.getUint16(),e=F._BLOCK.blockStarts=[],i=F._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(F._reader.getUint32()),i.push(F._reader.getUint32())},F.READ_STRINGS=function(){var t=F._reader.getUint32(),e=F._reader.getUint16(),i=F._reader.pos;F._reader.pos=t+F._DATA.offset;for(var a=0;a<e;a++)F._strings[a]=F._reader.readUTFString();F._reader.pos=i},F.parse=function(t,e){F._templet=t,(F._reader=e).__getBuffer(),F.READ_DATA(),F.READ_BLOCK(),F.READ_STRINGS();for(var i=0,a=F._BLOCK.count;i<a;i++){var s=e.getUint16(),r=F._strings[s],n=F["READ_"+r];if(null==n)throw new Error("model file err,no this function:"+s+" "+r);n.call()}},F.READ_ANIMATIONS=function(){var t=F._reader,e=t.__getBuffer(),i=0,a=0,s=0,r=0,n=t.getUint16(),h=[];for(h.length=n,i=0;i<n;i++)h[i]=Dt.interpolation[t.getByte()];var l=t.getUint8();for(F._templet._anis.length=l,i=0;i<l;i++){var o=F._templet._anis[i]={};o.nodes=new Array;var u=o.name=F._strings[t.getUint16()];F._templet._aniMap[u]=i,o.bone3DMap={},o.playTime=t.getFloat32();var c=o.nodes.length=t.getInt16();for(a=o.totalKeyframeDatasLength=0;a<c;a++){var d=o.nodes[a]={};d.keyframeWidth=n,d.childs=[],0<=(_=t.getUint16())&&(d.name=F._strings[_],o.bone3DMap[d.name]=a),d.keyFrame=new Array,d.parentIndex=t.getInt16(),-1==d.parentIndex?d.parent=null:d.parent=o.nodes[d.parentIndex],o.totalKeyframeDatasLength+=n,d.interpolationMethod=h,null!=d.parent&&d.parent.childs.push(d);var _=t.getUint16(),p=null,f=null;for(s=0,r=d.keyFrame.length=_;s<r;s++){(p=d.keyFrame[s]={}).startTime=t.getFloat32(),f&&(f.duration=p.startTime-f.startTime);var m=F._DATA.offset,y=t.getUint32();y=e.slice(m+y,m+y+4*n),p.data=new Float32Array(y),f=p}p.duration=0,d.playTime=o.playTime,F._templet._calculateKeyFrame(d,_,n)}}},F._templet=null,F._reader=null,F._strings=[],e(F,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),F);function F(){}function k(){}i(k,"laya.ani.AnimationState"),k.stopped=0,k.paused=1,k.playing=2;var P=function(){function e(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new ut,this.resultMatrix=new p,this._children=[]}i(e,"laya.ani.bone.Bone");var a=e.prototype;return a.setTempMatrix=function(t){this._tempMatrix=t;for(var e=0,i=(e=0,this._children.length);e<i;e++)this._children[e].setTempMatrix(this._tempMatrix)},a.update=function(t){var e,i,a,s,r,n,h;this.rotation=this.transform.skX,t?(r=this.resultTransform.getMatrix(),p.mul(r,t,this.resultMatrix),this.resultRotation=this.rotation):(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone?this.inheritRotation&&this.inheritScale?(r=this.resultTransform.getMatrix(),p.mul(r,this.parentBone.resultMatrix,this.resultMatrix)):(e=this.parentBone,s=a=i=NaN,h=this.parentBone.resultMatrix,r=this.resultTransform.getMatrix(),n=h.a*r.tx+h.c*r.ty+h.tx,t=h.b*r.tx+h.d*r.ty+h.ty,h=new p,this.inheritRotation?(i=Math.atan2(e.resultMatrix.b,e.resultMatrix.a),a=Math.cos(i),s=Math.sin(i),h.setTo(a,s,-s,a,0,0),p.mul(this._tempMatrix,h,p.TEMP),p.TEMP.copyTo(h),r=this.resultTransform.getMatrix(),p.mul(r,h,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,r=this.resultTransform.getMatrix(),p.TEMP.identity(),p.TEMP.d=this.d,p.mul(r,p.TEMP,this.resultMatrix)),this.resultMatrix.tx=n,this.resultMatrix.ty=t):(r=this.resultTransform.getMatrix()).copyTo(this.resultMatrix));for(var l=0,o=(l=0,this._children.length);l<o;l++)this._children[l].update()},a.updateChild=function(){for(var t=0,e=(t=0,this._children.length);t<e;t++)this._children[t].update()},a.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},a.updateDraw=function(i,a){e.ShowBones&&!e.ShowBones[this.name]||(this._sprite||(this._sprite=new v,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),t.stage.addChild(this._sprite)),this._sprite.x=i+this.resultMatrix.tx,this._sprite.y=a+this.resultMatrix.ty);for(var s=0,r=(s=0,this._children.length);s<r;s++)this._children[s].updateDraw(i,a)},a.addChild=function(t){this._children.push(t),t.parentBone=this},a.findBone=function(t){if(this.name==t)return this;for(var e,i=0,a=(i=0,this._children.length);i<a;i++)if(e=this._children[i].findBone(t))return e;return null},a.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},e.ShowBones={},e}(),B=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this.originalIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}i(t,"laya.ani.bone.BoneSlot");var a=t.prototype;return a.showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},a.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},a.replaceDisplayByName=function(t,e){var i;this.currSlotData&&(i=this.currSlotData.getDisplayByName(t),t=0,t=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,t))},a.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.originalIndex==t&&this.showDisplayByIndex(t))},a.showDisplayByIndex=function(t){this.originalIndex=t,null!=this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&-1<t&&t<this.currSlotData.displayArr.length?(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData&&(t=this.currDisplayData.name,this.currTexture=this.templet.getTexture(t),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!m.isConchApp||m.isConchApp&&"0.9.15"<v.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture)))):(this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null)},a.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},a.setParentMatrix=function(t){this._parentMatrix=t},a.draw=function(e,i,a,s){if(void 0===a&&(a=!1),void 0===s&&(s=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var r,n,h=this.currTexture;switch(this._diyTexture&&(h=this._diyTexture),this.currDisplayData.type){case 0:e&&(n=this.getDisplayMatrix(),this._parentMatrix&&(l=!1,n&&(p.mul(n,this._parentMatrix,p.TEMP),o=a?(null==this._resultMatrix&&(this._resultMatrix=new p),this._resultMatrix):new p,!m.isWebGL&&this.currDisplayData.uvs||m.isWebGL&&this._diyTexture&&this.currDisplayData.uvs?((n=t._tempMatrix).identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(n.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(l=!0,n.rotate(-Math.PI/2)),p.mul(n,p.TEMP,o)):p.TEMP.copyTo(o),l?e.drawTexture(h,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,o):e.drawTexture(h,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,o))));break;case 1:if(null==(r=a?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),this._skinSprite):t.createSkinMesh()))return;var l,o;null==this.currDisplayData.bones?(l=this.currDisplayData.weights,this.deformData&&(l=this.deformData),o=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=ct.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=ct.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=l,this.currDisplayData.triangles.length,l=this.currDisplayData.triangles,r.init2(h,null,l,this._mVerticleArr,o),o=this.getDisplayMatrix(),this._parentMatrix&&o&&(p.mul(o,this._parentMatrix,p.TEMP),o=a?(null==this._resultMatrix&&(this._resultMatrix=new p),this._resultMatrix):new p,p.TEMP.copyTo(o),r.transform=o)):this.skinMesh(i,r,s),e.drawSkin(r);break;case 2:if(null==(r=a?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),this._skinSprite):t.createSkinMesh()))return;this.skinMesh(i,r,s),e.drawSkin(r)}}},a.skinMesh=function(t,e,i){var a,s=this.currTexture,r=this.currDisplayData.bones,n=this._diyTexture?(s=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=ct.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=ct.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,h=this.currDisplayData.weights,l=this.currDisplayData.triangles,o=0,u=0,c=0,d=NaN,_=NaN,p=0,f=0,m=[],y=0,x=0;if(this.deformData&&0<this.deformData.length){var g=0;for(y=0,x=r.length;y<x;){for(c=r[y++]+y,u=o=0;y<c;y++)a=t[r[y]],d=h[p]+this.deformData[g++],_=h[p+1]+this.deformData[g++],f=h[p+2],o+=(d*a.a+_*a.c+a.tx)*f,u+=(d*a.b+_*a.d+a.ty)*f,p+=3;m.push(o,u)}}else for(y=0,x=r.length;y<x;){for(c=r[y++]+y,u=o=0;y<c;y++)a=t[r[y]],d=h[p],_=h[p+1],f=h[p+2],o+=(d*a.a+_*a.c+a.tx)*f,u+=(d*a.b+_*a.d+a.ty)*f,p+=3;m.push(o,u)}this._mVerticleArr=m,e.init2(s,null,l,this._mVerticleArr,n)},a.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},a.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},a.getMatrix=function(){return this._resultMatrix},a.copy=function(){var e=new t;return e.type="copy",e.name=this.name,e.attachmentName=this.attachmentName,e.srcDisplayIndex=this.srcDisplayIndex,e.parent=this.parent,e.displayIndex=this.displayIndex,e.templet=this.templet,e.currSlotData=this.currSlotData,e.currTexture=this.currTexture,e.currDisplayData=this.currDisplayData,e},t.createSkinMesh=function(){return m.isWebGL||m.isConchApp?x.skinAniSprite():m.isWebGL?null:new(It.useSimpleMeshInCanvas?Mt:vt)},e(t,["_tempMatrix",function(){return this._tempMatrix=new p}]),t}(),U=function(){function t(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}i(t,"laya.ani.bone.canvasmesh.CanvasMeshRender");var e=t.prototype;return e.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},e._renderNoIndexes=function(t){var e,i=0,a=t.vertices.length/2;for(i=0;i<a-2;i++)this._renderDrawTriangle(t,e=2*i,2+e,4+e)},e._renderWithIndexes=function(t){var e=t.indexes,i=0,a=e.length;for(i=0;i<a;i+=3){var s=2*e[i],r=2*e[i+1],n=2*e[i+2];this._renderDrawTriangle(t,s,r,n)}},e._renderDrawTriangle=function(t,e,i,a){var s,r=this.context,n=t.uvs,h=t.vertices,l=t.texture,o=(A=l.bitmap).source,u=l.width,c=l.height,d=A.width,_=A.height,p=NaN,f=NaN,m=NaN,y=NaN,x=NaN;s=t.useUvTransform?(g=t.uvTransform,p=(n[e]*g.a+n[e+1]*g.c+g.tx)*d,f=(n[i]*g.a+n[i+1]*g.c+g.tx)*d,m=(n[a]*g.a+n[a+1]*g.c+g.tx)*d,y=(n[e]*g.b+n[e+1]*g.d+g.ty)*_,x=(n[i]*g.b+n[i+1]*g.d+g.ty)*_,(n[a]*g.b+n[a+1]*g.d+g.ty)*_):(p=n[e]*d,f=n[i]*d,m=n[a]*d,y=n[e+1]*_,x=n[i+1]*_,n[a+1]*_);var g,v=h[e],D=h[i],M=h[a],I=h[e+1],b=h[i+1],A=h[a+1];0<t.canvasPadding&&(g=t.canvasPadding,n=t.canvasPadding,i=I-(e=(I+b+A)/3),v=(h=(v+D+M)/3)+(a=v-h)/(t=Math.sqrt(a*a+i*i))*(t+g),I=e+i/t*(t+n),i=b-e,D=h+(a=D-h)/(t=Math.sqrt(a*a+i*i))*(t+g),b=e+i/t*(t+n),i=A-e,M=h+(a=M-h)/(t=Math.sqrt(a*a+i*i))*(t+g),A=e+i/t*(t+n)),r.save(),this.transform&&(N=this.transform,r.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)),r.beginPath(),r.moveTo(v,I),r.lineTo(D,b),r.lineTo(M,A),r.closePath(),r.clip();var N=1/(p*x+y*m+f*s-x*m-y*f-p*s);r.transform((v*x+y*M+D*s-x*M-y*D-v*s)*N,(I*x+y*A+b*s-x*A-y*b-I*s)*N,(p*D+v*m+f*M-D*m-v*f-p*M)*N,(p*b+I*m+f*A-b*m-I*f-p*A)*N,(p*x*M+y*D*m+v*f*s-v*x*m-y*f*M-p*D*s)*N,(p*x*A+y*b*m+I*f*s-I*x*m-y*f*A-p*b*s)*N),r.drawImage(o,l.uv[0]*d,l.uv[1]*_,u,c,l.uv[0]*d,l.uv[1]*_,u,c),r.restore()},t}(),L=(i(R,"laya.ani.bone.canvasmesh.MeshData"),R.prototype.getBounds=function(){return f._getWrapRec(this.vertices)},R);function R(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}var O=(i(E,"laya.ani.bone.DeformAniData"),E);function E(){this.skinName=null,this.deformSlotDataList=[]}var V=(i(K,"laya.ani.bone.DeformSlotData"),K);function K(){this.deformSlotDisplayList=[]}var Y=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}i(t,"laya.ani.bone.DeformSlotDisplayData");var e=t.prototype;return e.binarySearch1=function(t,e){var i=0,a=t.length-2;if(0==a)return 1;for(var s=a>>>1;;){if(t[Math.floor(s+1)]<=e?i=s+1:a=s,i==a)return i+1;s=i+a>>>1}return 0},e.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var a=0;if(!(t<this.timeList[0])){var s=this.vectices[0].length,r=[],n=this.binarySearch1(this.timeList,t);if(this.frameIndex=n,t>=this.timeList[this.timeList.length-1]){var h=this.vectices[this.vectices.length-1];if(i<1)for(a=0;a<s;a++)r[a]+=(h[a]-r[a])*i;else for(a=0;a<s;a++)r[a]=h[a];this.deformData=r}else{this.tweenKeyList[this.frameIndex];var l,o=this.vectices[this.frameIndex-1],u=this.vectices[this.frameIndex],c=this.timeList[this.frameIndex-1],d=this.timeList[this.frameIndex];for(i=this.tweenKeyList[n-1]?(t-c)/(d-c):0,a=0;a<s;a++)l=o[a],r[a]=l+(u[a]-l)*i;this.deformData=r}}}},t}(),W=(i(X,"laya.ani.bone.DrawOrderData"),X);function X(){this.time=NaN,this.drawOrder=[]}var z=(i(q,"laya.ani.bone.EventData"),q);function q(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.audioValue=null,this.time=NaN}var G=function(){function a(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]);for(var i=this._bones.length=0,a=t.boneIndexs.length;i<a;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}i(a,"laya.ani.bone.IkConstraint");var s=a.prototype;return s.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},s._applyIk1=function(t,e,i,s){var r=t.parentBone,n=1/(r.resultMatrix.a*r.resultMatrix.d-r.resultMatrix.b*r.resultMatrix.c),h=e-r.resultMatrix.tx;e=i-r.resultMatrix.ty,i=(h*r.resultMatrix.d-e*r.resultMatrix.c)*n-t.transform.x,n=(e*r.resultMatrix.a-h*r.resultMatrix.b)*n-t.transform.y,i=Math.atan2(n,i)*a.radDeg-t.transform.skX,t.transform.scX<0&&(i+=180),180<i?i-=360:i<-180&&(i+=360),t.transform.skX=t.transform.skY=t.transform.skX+i*s,t.update()},s.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},s._applyIk2=function(e,i,s,r,n,h){var l,o,u,c,d,_,p,f,m,y,x,g,D,M,I,b,A,N,T,C,S,w,F,k,P,B;0!=h&&(l=e.resultTransform.x,o=e.resultTransform.y,c=(A=e.transform.scX)<(c=u=0)?(A=-A,u=180,-1):(u=0,1),(S=e.transform.scY)<0&&(S=-S,c=-c),d=(D=i.transform.scX)<0?(D=-D,180):0,_=i.resultTransform.x,y=B=p=NaN,x=e.resultMatrix.a,g=e.resultMatrix.c,N=e.resultMatrix.b,b=e.resultMatrix.d,y=(k=Math.abs(A-S)<=1e-4)?(B=x*_+g*(p=i.resultTransform.y)+e.resultMatrix.tx,N*_+b*p+e.resultMatrix.ty):(p=0,B=x*_+e.resultMatrix.tx,N*_+e.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new v,t.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(s,r,15,"#ffff00"),this._sp.graphics.drawCircle(B,y,15,"#ff00ff")),e.setRotation(Math.atan2(y-e.resultMatrix.ty,B-e.resultMatrix.tx)),x=(m=e.parentBone).resultMatrix.a,g=m.resultMatrix.c,N=m.resultMatrix.b,I=1/(x*(b=m.resultMatrix.d)-g*N),s=((F=s-m.resultMatrix.tx)*b-(f=r-m.resultMatrix.ty)*g)*I-l,r=(f*x-F*N)*I-o,B=((F=B-m.resultMatrix.tx)*b-(f=y-m.resultMatrix.ty)*g)*I-l,y=(f*x-F*N)*I-o,m=Math.sqrt(B*B+y*y),I=i.length*D,y=B=NaN,k?((M=(s*s+r*r-m*m-(I*=A)*I)/(2*m*I))<-1?M=-1:1<M&&(M=1),y=Math.acos(M)*n,x=m+I*M,g=I*Math.sin(y),B=Math.atan2(r*x-s*g,s*x+r*g)):(D=(x=A*I)*x,k=(g=S*I)*g,M=s*s+r*r,I=Math.atan2(r,s),0<(b=(r=-2*k*m)*r-4*(s=k-D)*(N=k*m*m+D*M-D*k))&&(T=Math.sqrt(b),P=(T=-(r+(T=r<0?-T:T))/2)/s,C=N/T,(w=Math.abs(P)<Math.abs(C)?P:C)*w<=M&&(f=Math.sqrt(M-w*w)*n,B=I-Math.atan2(f,w),y=Math.atan2(f/S,(w-m)/A))),w=S=C=P=T=N=s=0,C<(b=(F=m+x)*F)&&(P=0,C=b,S=F),(b=(F=m-x)*F)<(A=Number.MAX_VALUE)&&(s=Math.PI,A=b,N=F),k=Math.acos(-x*m/(D-k)),(b=(F=x*Math.cos(k)+m)*F+(f=g*Math.sin(k))*f)<A&&(s=k,A=b,N=F,T=f),C<b&&(P=k,C=b,S=F,w=f),y=M<=(A+C)/2?(B=I-Math.atan2(T*n,N),s*n):(B=I-Math.atan2(w*n,S),P*n)),P=Math.atan2(p,_)*c,n=e.resultTransform.skX,180<(B=(B-P)*a.radDeg+u-n)?B-=360:B<-180&&(B+=360),e.resultTransform.x=l,e.resultTransform.y=o,e.resultTransform.skX=e.resultTransform.skY=n+B*h,n=i.resultTransform.skX,180<(y=(y+P)*a.radDeg*c+d-(n%=360))?y-=360:y<-180&&(y+=360),i.resultTransform.x=_,i.resultTransform.y=p,i.resultTransform.skX=i.resultTransform.skY=i.resultTransform.skY+y*h,e.update())},s._applyIk3=function(e,i,s,r,n,h){var l,o,u,c,d,_,p,f,m,y,x,g,D,M;0!=h&&(y=(g=i.resultMatrix.a*i.length)*g+(x=i.resultMatrix.b*i.length)*x,u=Math.sqrt(y),M=e.resultMatrix.tx,D=e.resultMatrix.ty,c=(d=(p=i.resultMatrix.tx)-M)*d+(_=i.resultMatrix.ty-D)*_,h=Math.sqrt(c),g=(d=s-e.resultMatrix.tx)*d+(_=r-e.resultMatrix.ty)*_,f=u+h<=(x=Math.sqrt(g))||x+u<=h||x+h<=u?(m=NaN,p=M+(m=u+h<=x?1:-1)*(s-M)*h/x,D+m*(r-D)*h/x):(h=M+d*(m=(c-y+g)/(2*g)),y=D+_*m,x=-_*(g=Math.sqrt(c-m*m*g)/x),g*=d,0<n?(p=h-x,y-g):(p=h+x,y+g)),l=p,o=f,this.isDebug&&(this._sp||(this._sp=new v,t.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(M,D,15,"#ff00ff"),this._sp.graphics.drawCircle(s,r,15,"#ffff00"),this._sp.graphics.drawCircle(l,o,15,"#ff00ff")),M=NaN,M=Math.atan2(o-e.resultMatrix.ty,l-e.resultMatrix.tx),e.setRotation(M),(D=a._tempMatrix).identity(),D.rotate(M),D.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),D.translate(e.resultMatrix.tx,e.resultMatrix.ty),D.copyTo(e.resultMatrix),e.updateChild(),e=NaN,e=Math.atan2(r-o,s-l),i.setRotation(e),(s=a._tempMatrix).identity(),s.rotate(e),s.scale(i.resultMatrix.getScaleX(),i.resultMatrix.getScaleY()),s.translate(l,o),D.copyTo(i.resultMatrix),i.updateChild())},e(a,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new p}]),a}(),H=(i(Q,"laya.ani.bone.IkConstraintData"),Q);function Q(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}var Z=(i(j,"laya.ani.bone.MeshTools"),j.findEdge=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var a=0,s=0,r=t.length;for(s=-1,a=0;a<r;a+=2)(s<0||i==t[s+e]<t[a+e])&&(s=a);return s},j.findBestTriangle=function(t){var e=j.findEdge(t,1,!0),i=j.findEdge(t,1,!1),a=j.findEdge(t,0,!0),s=j.findEdge(t,0,!1);return(t=j._bestTriangle).length=0,t.push(a,s),t.indexOf(e)<0&&t.push(e),t.indexOf(i)<0&&t.push(i),t},j.solveMesh=function(t,e){(e=e||[]).length=0;var i,a=t.uvs,s=t.vertices,r=(i=j.findBestTriangle(a))[0],n=i[1],h=i[2];return j._absArr.length=0,j.isNormalUV(t.texture.uv)&&j.adptTexture(t),a=j.solvePoints(t.texture.uv,a[r],a[r+1],a[n]-a[r],a[n+1]-a[r+1],a[h]-a[r],a[h+1]-a[r+1],j._absArr),j.transPoints(a,s[r],s[r+1],s[n]-s[r],s[n+1]-s[r+1],s[h]-s[r],s[h+1]-s[r+1],e)},j.findWrapRect=function(t){var e=0,i=(e=j.findEdge(t,1,!0),j.findEdge(t,1,!1)),a=j.findEdge(t,0,!0),s=j.findEdge(t,0,!1),r=t[a];return a=t[s],s=t[e+1],e=NaN,[a,e=t[i+1],r-a,s-e]},j.adptTexture=function(t){var e=j.findWrapRect(t.uvs),i=t.texture,a=i.width,s=i.height;s=M.create(i,e[0]*a,e[1]*s,e[2]*a,e[3]*s),t.texture=s},j.isNormalUV=function(t){return 0==t[0]&&0==t[1]&&1==t[4]&&1==t[5]},j.solvePoints=function(t,e,i,a,s,r,n,h){h=h||[];var l,o=0,u=t.length;for(o=0;o<u;o+=2)l=j.solve2(t[o],t[o+1],e,i,a,s,r,n),h.push(l[0],l[1]);return h},j.transPoints=function(t,e,i,a,s,r,n,h){h=h||[];var l=0,o=t.length;for(l=0;l<o;l+=2)j.transPoint(t[l],t[l+1],e,i,a,s,r,n,h);return h},j.transPoint=function(t,e,i,a,s,r,n,h,l){return(l=l||[]).push(i+s*t+n*e,a+r*t+h*e),l},j.solve2=function(t,e,i,a,s,r,n,h,l,o){var u;if(void 0===l&&(l=!1),o=o||[],0==s)return j.solve2(t,e,i,a,n,h,s,r,!0,o);var c,d=((c=t-i)-(u=(e-a-c*r/s)/(h-n*r/s))*n)/s;return l?o.push(u,d):o.push(d,u),o},j.solve=function(t,e,i,a){return j.solve2(t.x,t.y,e.x,e.y,i.x,i.y,a.x,a.y)},j._bestTriangle=[],j._absArr=[],j);function j(){}var $=function(){function t(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,a=0,s=i.length;a<s;a++)this.bones.push(e[i[a]])}i(t,"laya.ani.bone.PathConstraint");var a=t.prototype;return a.apply=function(t,e){if(this.target){var i=this.translateMix,a=this.translateMix,s=0<a,r=this.data.spacingMode,n="length"==r,h=this.data.rotateMode,l="tangent"==h,o="chainScale"==h,u=[],c=this.bones.length,d=l?c:c+1,_=[];(this._spaces=_)[0]=this.position;var p=this.spacing;if(o||n)for(var f=0,m=d-1;f<m;){var y=this.bones[f],x=(v=y.length)*y.resultMatrix.a,g=v*y.resultMatrix.b,v=Math.sqrt(x*x+g*g);o&&(u[f]=v),_[++f]=n?Math.max(0,v+p):p}else for(f=1;f<d;f++)_[f]=p;var D=this.computeWorldPositions(this.target,t,e,d,l,"percent"==this.data.positionMode,"percent"==r);if(this._debugKey){for(f=0;f<D.length;f++)e.drawCircle(D[f++],D[f++],5,"#00ff00");var M=[];for(f=0;f<D.length;f++)M.push(D[f++],D[f++]);e.drawLines(0,0,M,"#ff0000")}var I=D[0],b=D[1],A=this.data.offsetRotation,N="chain"==h&&0==A,T=NaN;for(f=0,T=3;f<c;f++,T+=3){(y=this.bones[f]).resultMatrix.tx+=(I-y.resultMatrix.tx)*i,y.resultMatrix.ty+=(b-y.resultMatrix.ty)*i;var C,S,w,F,k,P,B,U=(x=D[T])-I,L=(g=D[T+1])-b;o&&0!=(v=u[f])&&(P=(Math.sqrt(U*U+L*L)/v-1)*a+1,y.resultMatrix.a*=P,y.resultMatrix.c*=P),I=x,b=g,s&&(C=y.resultMatrix.a,S=y.resultMatrix.c,w=y.resultMatrix.b,F=y.resultMatrix.d,P=k=B=NaN,B=l?D[T-1]:0==_[f+1]?D[T+2]:Math.atan2(L,U),B-=Math.atan2(w,C)-A/180*Math.PI,N&&(k=Math.cos(B),P=Math.sin(B),I+=((v=y.length)*(k*C-P*w)-U)*a,b+=(v*(P*C+k*w)-L)*a),B>Math.PI?B-=2*Math.PI:B<-Math.PI&&(B+=2*Math.PI),B*=a,k=Math.cos(B),P=Math.sin(B),y.resultMatrix.a=k*C-P*w,y.resultMatrix.c=k*S-P*F,y.resultMatrix.b=P*C+k*w,y.resultMatrix.d=P*S+k*F)}}},a.computeWorldVertices2=function(e,i,a,s,r,n){var h,l,o=e.currDisplayData.bones,u=e.currDisplayData.weights,c=e.currDisplayData.triangles,d=0,_=0,p=0,f=0,m=0,y=0,x=0,g=0,v=0,D=0;if(null!=o){for(d=0;d<a;d+=2)_+=(f=o[_])+1,p+=f;var M=i;for(m=n,y=3*p;m<s;m+=2){for(g=x=0,f=o[_++],f+=_;_<f;_++,y+=3){var I=M[o[_]].resultMatrix,b=(v=u[y],D=u[y+1],u[y+2]);x+=(v*I.a+D*I.c+I.tx)*b,g+=(v*I.b+D*I.d+I.ty)*b}r[m]=x,r[m+1]=g}}else{var A;if(c=c||u,e.deformData&&(c=e.deformData),A=e.parent,i)for(l=i.length,d=0;d<l;d++)if(i[d].name==A){h=i[d];break}var N,T=(N=(N=h?h.resultMatrix:N)||t._tempMt).tx,C=N.ty,S=N.a,w=N.b,F=N.c,k=N.d;for(h&&(k*=h.d),_=a,m=n;m<s;_+=2,m+=2)v=c[_],D=c[_+1],r[m]=v*S+D*w+T,r[m+1]=-(v*F+D*k+C)}},a.computeWorldPositions=function(t,e,i,a,s,r,n){t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles;var h,l=[],o=0,u=t.currDisplayData.verLen,c=this.position,d=this._spaces,_=[],p=u/6,f=-1,m=NaN,y=0,x=0,g=NaN,v=NaN,D=NaN,M=NaN;if(p--,this.computeWorldVertices2(t,e,2,u-=4,l,0),this._debugKey)for(o=0;o<l.length;)i.drawCircle(l[o++],l[o++],10,"#ff0000");h=l,this._curves.length=p;var I=this._curves,b=h[m=0],A=h[1],N=0,T=0,C=0,S=0,w=0,F=0,k=NaN,P=NaN,B=NaN,U=NaN,L=NaN,R=NaN,O=NaN,E=NaN,V=0;for(o=0,V=2;o<p;o++,V+=6)L=2*(k=.1875*(b-2*(N=h[V])+(C=h[V+2])))+(B=.09375*(3*(N-C)-b+(w=h[V+4]))),R=2*(P=.1875*(A-2*(T=h[V+1])+(S=h[V+3])))+(U=.09375*(3*(T-S)-A+(F=h[V+5]))),O=.75*(N-b)+k+.16666667*B,E=.75*(T-A)+P+.16666667*U,m+=Math.sqrt(O*O+E*E),O+=L,E+=R,L+=B,R+=U,m+=Math.sqrt(O*O+E*E),O+=L,E+=R,m+=Math.sqrt(O*O+E*E),O+=L+B,E+=R+U,m+=Math.sqrt(O*O+E*E),I[o]=m,b=w,A=F;if(r&&(c*=m),n)for(o=0;o<a;o++)d[o]*=m;var K=this._segments,Y=0,W=0;for(W=x=y=o=0;o<a;o++,y+=3)if((g=c+=v=d[o])<0)this.addBeforePosition(g,h,0,_,y);else if(m<g)this.addAfterPosition(g-m,h,u-4,_,y);else{for(;;x++)if(!((M=I[x])<g)){0==x?g/=M:g=(g-(D=I[x-1]))/(M-D);break}if(x!=f){f=x;var X=6*x;for(L=2*(k=.03*((b=h[X])-2*(N=h[X+2])+(C=h[X+4])))+(B=.006*(3*(N-C)-b+(w=h[X+6]))),R=2*(P=.03*((A=h[X+1])-2*(T=h[X+3])+(S=h[X+5])))+(U=.006*(3*(T-S)-A+(F=h[X+7]))),O=.3*(N-b)+k+.16666667*B,E=.3*(T-A)+P+.16666667*U,Y=Math.sqrt(O*O+E*E),K[0]=Y,X=1;X<8;X++)O+=L,E+=R,L+=B,R+=U,Y+=Math.sqrt(O*O+E*E),K[X]=Y;O+=L,E+=R,Y+=Math.sqrt(O*O+E*E),K[8]=Y,O+=L+B,E+=R+U,Y+=Math.sqrt(O*O+E*E),K[9]=Y,W=0}for(g*=Y;;W++)if(!((M=K[W])<g)){0==W?g/=M:g=W+(g-(D=K[W-1]))/(M-D);break}this.addCurvePosition(.1*g,b,A,N,T,C,S,w,F,_,y,s||0<o&&0==v)}return _},a.addBeforePosition=function(t,e,i,a,s){var r=e[i],n=e[i+1],h=e[i+2]-r;i=e[i+3]-n,h=Math.atan2(i,h),a[s]=r+t*Math.cos(h),a[s+1]=n+t*Math.sin(h),a[s+2]=h},a.addAfterPosition=function(t,e,i,a,s){var r=e[i+2],n=e[i+3],h=r-e[i];i=n-e[i+1],h=Math.atan2(i,h),a[s]=r+t*Math.cos(h),a[s+1]=n+t*Math.sin(h),a[s+2]=h},a.addCurvePosition=function(t,e,i,a,s,r,n,h,l,o,u,c){var d,_=(t=0==t?1e-4:t)*t,p=_*t,f=(d=1-t)*d,m=f*d,y=d*t,x=3*y;h=e*m+a*(d*=x)+r*(t*=x)+h*p,p=i*m+s*d+n*t+l*p,o[u]=h,o[u+1]=p,o[u+2]=c?Math.atan2(p-(i*f+s*y*2+n*_),h-(e*f+a*y*2+r*_)):0},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,e(t,["_tempMt",function(){return this._tempMt=new p}]),t}(),J=(i(tt,"laya.ani.bone.PathConstraintData"),tt);function tt(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}var et=(i(it,"laya.ani.bone.SkinData"),it);function it(){this.name=null,this.slotArr=[]}var at=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}i(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.createTexture=function(t){return this.texture||(this.texture=new M(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),m.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY),this.texture)},e.destory=function(){this.texture&&this.texture.destroy()},t}(),st=(i(rt,"laya.ani.bone.SlotData"),rt.prototype.getDisplayByName=function(t){for(var e=0,i=this.displayArr.length;e<i;e++)if(this.displayArr[e].attachmentName==t)return e;return-1},rt);function rt(){this.name=null,this.displayArr=[]}var nt=(i(ht,"laya.ani.bone.TfConstraint"),ht.prototype.apply=function(){for(var t=this.target.resultMatrix.a,e=this.target.resultMatrix.b,i=this.target.resultMatrix.c,a=this.target.resultMatrix.d,s=0,r=this._bones.length;s<r;s++){var n,h,l,o,u,c,d,_,p,f=this._bones[s];0<this.rotateMix&&(n=f.resultMatrix.a,c=f.resultMatrix.b,h=f.resultMatrix.c,d=f.resultMatrix.d,(p=Math.atan2(i,t)-Math.atan2(h,n)+this._data.offsetRotation*Math.PI/180)>Math.PI?p-=2*Math.PI:p<-Math.PI&&(p+=2*Math.PI),p*=this.rotateMix,o=Math.cos(p),l=Math.sin(p),f.resultMatrix.a=o*n-l*h,f.resultMatrix.b=o*c-l*d,f.resultMatrix.c=l*n+o*h,f.resultMatrix.d=l*c+o*d),this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),f.resultMatrix.tx+=(this._temp[0]-f.resultMatrix.tx)*this.translateMix,f.resultMatrix.ty+=(this._temp[1]-f.resultMatrix.ty)*this.translateMix,f.updateChild()),0<this.scaleMix&&(_=Math.sqrt(f.resultMatrix.a*f.resultMatrix.a+f.resultMatrix.c*f.resultMatrix.c),o=Math.sqrt(t*t+i*i),u=1e-5<_?(_+(o-_+this._data.offsetScaleX)*this.scaleMix)/_:0,f.resultMatrix.a*=u,f.resultMatrix.c*=u,_=Math.sqrt(f.resultMatrix.b*f.resultMatrix.b+f.resultMatrix.d*f.resultMatrix.d),o=Math.sqrt(e*e+a*a),u=1e-5<_?(_+(o-_+this._data.offsetScaleY)*this.scaleMix)/_:0,f.resultMatrix.b*=u,f.resultMatrix.d*=u),0<this.shearMix&&(c=f.resultMatrix.b,d=f.resultMatrix.d,_=Math.atan2(d,c),(p=Math.atan2(a,e)-Math.atan2(i,t)-(_-Math.atan2(f.resultMatrix.c,f.resultMatrix.a)))>Math.PI?p-=2*Math.PI:p<-Math.PI&&(p+=2*Math.PI),p=_+(p+this._data.offsetShearY*Math.PI/180)*this.shearMix,u=Math.sqrt(c*c+d*d),f.resultMatrix.b=Math.cos(p)*u,f.resultMatrix.d=Math.sin(p)*u)}},ht);function ht(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=s(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];for(var i=0,a=(i=0,t.boneIndexs.length);i<a;i++)this._bones.push(e[t.boneIndexs[i]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}var lt=(i(ot,"laya.ani.bone.TfConstraintData"),ot);function ot(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}var ut=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}i(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.skX&&(this.skX=t.skX),null!=t.skY&&(this.skY=t.skY),null!=t.scX&&(this.scX=t.scX),null!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t=this.mMatrix||(this.mMatrix=new p);return t.identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},e.skew=function(t,e,i){var a=Math.sin(i),s=Math.cos(i);return i=Math.sin(e),e=Math.cos(e),t.setTo(t.a*e-t.b*a,t.a*i+t.b*s,t.c*e-t.d*a,t.c*i+t.d*s,t.tx*e-t.ty*a,t.tx*i+t.ty*s),t},t}(),ct=(i(dt,"laya.ani.bone.UVTools"),dt.getRelativeUV=function(t,e,i){var a=t[0],s=t[2]-t[0],r=t[1];t=t[5]-t[1],(i=i||[]).length=e.length;var n=0,h=i.length,l=1/s,o=1/t;for(n=0;n<h;n+=2)i[n]=(e[n]-a)*l,i[n+1]=(e[n+1]-r)*o;return i},dt.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(I.copyArray(i,e),i):e;var a=t[0],s=t[2]-t[0],r=t[1],n=t[5]-t[1];(i=i||[]).length=e.length;var h=0,l=i.length;for(h=0;h<l;h+=2)i[h]=e[h]*s+a,i[h+1]=e[h+1]*n+r;return i},dt);function dt(){}var _t=(i(pt,"laya.ani.KeyFramesContent"),pt);function pt(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}var ft=(i(mt,"laya.ani.math.BezierLerp"),mt.getBezierRate=function(t,e,i,a,s){var r=mt._getBezierParamKey(e,i,a,s),n=100*r+t;if(mt._bezierResultCache[n])return mt._bezierResultCache[n];var h=mt._getBezierPoints(e,i,a,s,r),l=0,o=h.length;for(l=0;l<o;l+=2)if(t<=h[l])return mt._bezierResultCache[n]=h[l+1],h[l+1];return mt._bezierResultCache[n]=1},mt._getBezierParamKey=function(t,e,i,a){return 100*(100*(100*(100*t+e)+i)+a)},mt._getBezierPoints=function(t,e,i,a,s){return mt._bezierPointsCache[s]?mt._bezierPointsCache[s]:(a=[0,0,t,e,i,a,1,1],a=(new r).getBezierPoints(a,100,3),mt._bezierPointsCache[s]=a)},mt._bezierResultCache={},mt._bezierPointsCache={},mt);function mt(){}var yt=function(){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}i(e,"laya.ani.AnimationPlayer",l);var s=e.prototype;return t.imps(s,{"laya.resource.IDestroy":!0}),s._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},s._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,a=0,s=e.getAnimationCount();a<s;a++){for(var r=[],n=0,h=e.getAnimation(a).nodes.length;n<h;n++){for(var l=e.getAnimation(a).nodes[n],o=Math.floor(l.playTime/i+.01),u=new Uint16Array(o+1),c=-1,d=0,_=l.keyFrame.length;d<_;d++){var p=l.keyFrame[d],f=p.startTime,m=f+p.duration+i;do{for(var y=Math.floor(f/i+.5),x=c+1;x<y;x++)u[x]=d}while(u[c=y]=d,(f+=i)<=m)}r.push(u)}t.push(r)}},s._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},s._calculatePlayDuration=function(){var t;0!==this.state&&(t=this._templet.getAniDuration(this._currentAnimationClipIndex),0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart)},s._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e},s._setPlayParamsWhenStop=function(t,e,i){void 0===i&&(i=-1),this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor((0<i?i:t)/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},s._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==D.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var a=this.playDuration;if(i+=this._currentTime,0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=a||0===this._overallDuration&&i>=this.playEnd)return this._setPlayParamsWhenStop(a,e,this.playEnd),void this.event("stopped");if(0<a)if(a<=i){do{if(i-=a,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(a,e),this._stopWhenCircleFinish=!1,void this.event("stopped")}while(i<a&&(this._setPlayParams(i,e),this.event("complete")),a<=i)}else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(a,e),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},s._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},s.play=function(t,e,i,a,s){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===a&&(a=0),void 0===s&&(s=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||a<0||s<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==s&&s<a)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=a,this._playEnd=s,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=D.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},s.playByFrame=function(t,e,i,a,s,r){r=1e3/(r=void 0===r?30:r),this.play(t=void 0===t?0:t,e=void 0===e?1:e,i=void 0===i?2147483647:i,(a=void 0===a?0:a)*r,(s=void 0===s?0:s)*r)},s.stop=function(t){(t=void 0===t||t)?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},a(0,s,"playEnd",(function(){return this._playEnd})),a(0,s,"templet",(function(){return this._templet}),(function(t){0===!this.state&&this.stop(!0),this._templet!==t&&((this._templet=t).loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))})),a(0,s,"playStart",(function(){return this._playStart})),a(0,s,"playDuration",(function(){return this._playDuration})),a(0,s,"state",(function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2})),a(0,s,"currentKeyframeIndex",(function(){return this._currentKeyframeIndex})),a(0,s,"overallDuration",(function(){return this._overallDuration})),a(0,s,"currentFrameTime",(function(){return this._currentFrameTime})),a(0,s,"currentAnimationClipIndex",(function(){return this._currentAnimationClipIndex})),a(0,s,"currentPlayTime",(function(){return this._currentTime+this._playStart})),a(0,s,"cachePlayRate",(function(){return this._cachePlayRate}),(function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))})),a(0,s,"cacheFrameRate",(function(){return this._cacheFrameRate}),(function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))})),a(0,s,"currentTime",null,(function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=D.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e),0),this._currentFrameTime=this._currentKeyframeIndex*e}})),a(0,s,"paused",(function(){return this._paused}),(function(t){(this._paused=t)&&this.event("paused")})),a(0,s,"cacheFrameRateInterval",(function(){return this._cacheFrameRateInterval})),a(0,s,"destroyed",(function(){return this._destroyed})),e}(),xt=(i(gt,"laya.ani.GraphicsAni",o),gt.prototype.drawSkin=function(t){this._saveToCmd(m._context._drawSkin,[t])},gt.create=function(){return gt._caches.pop()||new gt},gt.recycle=function(t){t.clear(),gt._caches.push(t)},gt._caches=[],gt);function gt(){gt.__super.call(this),m.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=p.EMPTY),this._addCmd([t]),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}var vt=function(){function t(){t.__super.call(this),this.mesh=new L}i(t,"laya.ani.bone.canvasmesh.SkinMeshCanvas",U);var a=t.prototype;return a.init2=function(t,e,i,a,s){var r;this.transform&&(this.transform=null),i?r=i:(r=[]).push(0,1,3,3,1,2),this.mesh.texture=t,this.mesh.indexes=r,this.mesh.vertices=a,this.mesh.uvs=s},a.render=function(e,i,a){this.mesh.texture&&(this.transform?(this.transform.translate(i,a),this.renderToContext(e),this.transform.translate(-i,-a)):(this.transform=t._tempMatrix,this.transform.identity(),this.transform.translate(i,a),this.renderToContext(e),this.transform.translate(-i,-a),this.transform=null))},e(t,["_tempMatrix",function(){return this._tempMatrix=new p}]),t}(),Dt=function(){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,e.__super.call(this),this._anis=new Array}i(e,"laya.ani.AnimationTemplet",y);var a=e.prototype;return a.parse=function(t){t=new h(t),this._aniVersion=t.readUTFString(),C.parse(this,t)},a._calculateKeyFrame=function(t,e,i){var a=t.keyFrame;a[e]=a[0];for(var s=0;s<e;s++){var r=a[s];r.nextData=(0===r.duration?r:a[s+1]).data}a.length--},a.onAsynLoaded=function(t,e,i){e=new h(e),this._aniVersion=e.readUTFString(),("LAYAANIMATION:02"===this._aniVersion?w:C).parse(this,e),this._endLoaded()},a.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},a.getAnimationCount=function(){return this._anis.length},a.getAnimation=function(t){return this._anis[t]},a.getAniDuration=function(t){return this._anis[t].playTime},a.getNodes=function(t){return this._anis[t].nodes},a.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},a.getNodeCount=function(t){return this._anis[t].nodes.length},a.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},a.getPublicExtData=function(){return this._publicExtData},a.getAnimationDataWithCache=function(t,e,i,a){return(i=e[i])&&(t=i[t])?t[a]:null},a.setAnimationDataWithCache=function(t,e,i,a,s){((i=e[i]||(e[i]={}))[t]||(i[t]=[]))[a]=s},a.getOriginalData=function(t,i,a,s,r){for(var n=this._anis[t].nodes,h=0,l=0,o=n.length,u=0;l<o;l++){var c=n[l],d=c.keyFrame[a[l][s]];c.dataOffset=u;var _=r-d.startTime,p=c.lerpType;if(p)switch(p){case 0:case 1:for(h=0;h<c.keyframeWidth;)h+=c.interpolationMethod[h](c,h,i,u+h,d.data,_,null,d.duration,d.nextData);break;case 2:var f=d.interpolationData,m=f.length,y=0;for(h=0;h<m;){var x=f[h];switch(x){case 6:case 7:h+=e.interpolation[x](c,y,i,u+y,d.data,_,null,d.duration,d.nextData,f,h+1);break;default:h+=e.interpolation[x](c,y,i,u+y,d.data,_,null,d.duration,d.nextData)}y++}}else for(h=0;h<c.keyframeWidth;)h+=c.interpolationMethod[h](c,h,i,u+h,d.data,_,null,d.duration,d.nextData);u+=c.keyframeWidth}},a.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var a=0,s=i.length;a<s;a++){var r=i[a];for(e<this.unfixedCurrentTimes[a]&&(this.unfixedCurrentFrameIndexes[a]=0),this.unfixedCurrentTimes[a]=e;this.unfixedCurrentFrameIndexes[a]<r.keyFrame.length&&!(r.keyFrame[this.unfixedCurrentFrameIndexes[a]].startTime>this.unfixedCurrentTimes[a]);)this.unfixedCurrentFrameIndexes[a]++;this.unfixedCurrentFrameIndexes[a]--}return this.unfixedCurrentFrameIndexes},a.getOriginalDataUnfixedRate=function(t,i,a){var r=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(r.length),this.unfixedCurrentTimes=new Float32Array(r.length),this.unfixedKeyframes=s(r.length),this.unfixedLastAniIndex=t);for(var n=0,h=0,l=r.length,o=0;h<l;h++){var u=r[h];for(a<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=a;this.unfixedCurrentFrameIndexes[h]<u.keyFrame.length&&!(u.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=u.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var c=this.unfixedKeyframes[h];u.dataOffset=o;var d=a-c.startTime;if(u.lerpType)switch(u.lerpType){case 0:case 1:for(n=0;n<u.keyframeWidth;)n+=u.interpolationMethod[n](u,n,i,o+n,c.data,d,null,c.duration,c.nextData);break;case 2:var _=c.interpolationData,p=_.length,f=0;for(n=0;n<p;){var m=_[n];switch(m){case 6:case 7:n+=e.interpolation[m](u,f,i,o+f,c.data,d,null,c.duration,c.nextData,_,n+1);break;default:n+=e.interpolation[m](u,f,i,o+f,c.data,d,null,c.duration,c.nextData)}f++}}else for(n=0;n<u.keyframeWidth;)n+=u.interpolationMethod[n](u,n,i,o+n,c.data,d,null,c.duration,c.nextData);o+=u.keyframeWidth}},e._LinearInterpolation_0=function(t,e,i,a,s,r,n,h,l,o){return h=0===h?0:r/h,i[a]=(1-h)*s[e]+h*l[e],1},e._QuaternionInterpolation_1=function(t,e,i,a,s,r,n,h,l,o){return _.slerpQuaternionArray(s,e,l,e,0===h?0:r/h,i,a),4},e._AngleInterpolation_2=function(t,e,i,a,s,r,n,h,l,o){return 0},e._RadiansInterpolation_3=function(t,e,i,a,s,r,n,h,l,o){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,a,s,r,n,h,l,o){for(var u=0;u<16;u++,e++)i[a+u]=s[e]+r*n[e];return 16},e._NoInterpolation_5=function(t,e,i,a,s,r,n,h,l,o){return i[a]=s[e],1},e._BezierInterpolation_6=function(t,e,i,a,s,r,n,h,l,o,u){return i[a]=s[e]+(l[e]-s[e])*ft.getBezierRate(r/h,o[u=void 0===u?0:u],o[u+1],o[u+2],o[u+3]),5},e._BezierInterpolation_7=function(t,e,i,a,s,r,n,h,l,o,u){return i[a]=o[(u=void 0===u?0:u)+4]+o[u+5]*ft.getBezierRate((.001*r+o[u+6])/o[u+7],o[u],o[u+1],o[u+2],o[u+3]),9},e.load=function(i){return t.loader.create(i,null,null,e)},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4,e._NoInterpolation_5,e._BezierInterpolation_6,e._BezierInterpolation_7],e}(),Mt=(function(){function t(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,t.__super.call(this)}i(t,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",vt);var a=t.prototype;a.getCanvasPic=function(){var e,i=new u("2D"),a=i.getContext("2d");return this.rec=this.mesh.getBounds(),i.size(this.rec.width,this.rec.height),e=this.transform,this.transform=t.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(a),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=e,new M(i)},a.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=vt._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},a._renderTextureToContext=function(t){var e,i;this.context=t.ctx||t,t.save(),e=this.tex,this.transform&&(i=this.transform,t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)),this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},e(t,["tempMt",function(){return this.tempMt=new p}])}(),function(t){function e(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],e.__super.call(this),this.tempMesh=new L}i(e,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",t);var a=e.prototype;return a.init2=function(e,i,a,s,r){t.prototype.init2.call(this,e,i,a,s,r),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},a.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(this.mesh.uvs.length<=8?0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh):(this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=Z.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)))},a._renderWithIndexes=function(t){if(this.cacheCmdOK)this.renderByCache(t);else{var e=t.indexes,i=0,a=e.length;for(1<a&&(a=1),i=0;i<a;i+=3){var s=2*e[i],r=2*e[i+1],n=2*e[i+2];this._renderDrawTriangle(t,s,r,n)}this.cacheCmdOK=!0}},a._renderDrawTriangle=function(t,e,i,a){var s,r=this.context,n=t.uvs,h=t.vertices,l=t.texture,o=(M=l.bitmap).source,u=l.width,c=l.height,d=M.width,_=M.height,p=NaN,f=NaN,m=NaN,y=NaN,x=NaN;s=t.useUvTransform?(I=t.uvTransform,p=(n[e]*I.a+n[e+1]*I.c+I.tx)*d,f=(n[i]*I.a+n[i+1]*I.c+I.tx)*d,m=(n[a]*I.a+n[a+1]*I.c+I.tx)*d,y=(n[e]*I.b+n[e+1]*I.d+I.ty)*_,x=(n[i]*I.b+n[i+1]*I.d+I.ty)*_,(n[a]*I.b+n[a+1]*I.d+I.ty)*_):(p=n[e]*d,f=n[i]*d,m=n[a]*d,y=n[e+1]*_,x=n[i+1]*_,n[a+1]*_);var g=h[e],v=h[i],D=h[a],M=h[e+1],I=(t=h[i+1],h[a+1]);n=1/(p*x+y*m+f*s-x*m-y*f-p*s),e=p*v+g*m+f*D-v*m-g*f-p*D,i=p*x*D+y*v*m+g*f*s-g*x*m-y*f*D-p*v*s,h=M*x+y*I+t*s-x*I-y*t-M*s,a=p*t+M*m+f*I-t*m-M*f-p*I,t=p*x*I+y*t*m+M*f*s-M*x*m-y*f*I-p*t*s,this.transformCmds[0]=(g*x+y*D+v*s-x*D-y*v-g*s)*n,this.transformCmds[1]=h*n,this.transformCmds[2]=e*n,this.transformCmds[3]=a*n,this.transformCmds[4]=i*n,this.transformCmds[5]=t*n,this.drawCmds[0]=o,this.drawCmds[1]=l.uv[0]*d,this.drawCmds[2]=l.uv[1]*_,this.drawCmds[3]=u,this.drawCmds[4]=c,this.drawCmds[5]=l.uv[0]*d,this.drawCmds[6]=l.uv[1]*_,this.drawCmds[7]=u,this.drawCmds[8]=c,r.save(),this.transform&&(c=this.transform,r.transform(c.a,c.b,c.c,c.d,c.tx,c.ty)),r.transform.apply(r,this.transformCmds),r.drawImage.apply(r,this.drawCmds),r.restore()},a.renderByCache=function(t){var e,i=this.context;i.save(),this.transform&&(e=this.transform,i.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),i.transform.apply(i,this.transformCmds),i.drawImage.apply(i,this.drawCmds),i.restore()},e}(vt)),It=function(e){function s(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,this._playAudio=!0,this._soundChannelArr=[],s.__super.call(this),void 0===e&&(e=0),t&&this.init(t,e)}i(s,"laya.ani.bone.Skeleton",e);var r=s.prototype;return r.init=function(t,e){var i,a,s,r=0,n=0;if(1==(e=void 0===e?0:e))for(this._graphicsCache=[],r=0,n=t.getAnimationCount();r<n;r++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new yt,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,0<t.ikArr.length)for(this._ikArr=[],r=0,n=t.ikArr.length;r<n;r++)this._ikArr.push(new G(t.ikArr[r],this._boneList));if(0<t.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),r=0,n=t.pathArr.length;r<n;r++)i=t.pathArr[r],a=new $(i,this._boneList),(s=this._boneSlotDic[i.name])&&((a=new $(i,this._boneList)).target=s),this._pathDic[i.name]=a;if(0<t.tfArr.length)for(this._tfArr=[],r=0,n=t.tfArr.length;r<n;r++)this._tfArr.push(new nt(t.tfArr[r],this._boneList));0<t.skinDataArray.length&&(e=this._templet.skinDataArray[this._skinIndex],this._skinName=e.name),this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},r.load=function(e,i,a){void 0===a&&(a=0),this._aniPath=e,this._complete=i,this._loadAniMode=a,t.loader.load([{url:e,type:"arraybuffer"}],c.create(this,this._onLoaded))},r._onLoaded=function(){var t,e=d.getRes(this._aniPath);null!=e&&(null==bt.TEMPLET_DICTIONARY&&(bt.TEMPLET_DICTIONARY={}),(t=bt.TEMPLET_DICTIONARY[this._aniPath])?t.isParseFail?this._parseFail():t.isParserComplete?this._parseComplete():(t.on("complete",this,this._parseComplete),t.on("error",this,this._parseFail)):((t=new bt)._setUrl(this._aniPath),(bt.TEMPLET_DICTIONARY[this._aniPath]=t).on("complete",this,this._parseComplete),t.on("error",this,this._parseFail),t.isParserComplete=!1,t.parseData(null,e)))},r._parseComplete=function(){var t=bt.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},r._parseFail=function(){console.log("[Error]:"+this._aniPath+"")},r._onPlay=function(){this.event("played")},r._onStop=function(){var t,e=this._templet.eventAniArr[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)(t=e[this._eventIndex]).time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._drawOrder=null,this.event("stopped")},r._onPause=function(){this.event("paused")},r._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;t<e;t++)this._boneMatrixArray.push(new p);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,a,s=this._templet.boneSlotArray;for(t=0,e=s.length;t<e;t++)i=s[t],null==(a=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=a=[]),this._boneSlotDic[i.name]=i=i.copy(),a.push(i),this._boneSlotArray.push(i)}},r._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var a=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(a){var s,r=0,n=a.length;for(r=i;r<n;r++)(s=a[r]).time>=this._player.playStart&&s.time<=this._player.playEnd&&this.event("label",s)}},r._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=this.timer.currTimer,i=this._player.currentKeyframeIndex,a=e-this._lastTime;if(t?this._player._update(a):i=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<a&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var s,r;if(this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0),(i=this._templet.eventAniArr[this._aniClipIndex])&&this._eventIndex<i.length&&((i=i[this._eventIndex]).time>=this._player.playStart&&i.time<=this._player.playEnd?this._player.currentPlayTime>=i.time&&(this.event("label",i),this._eventIndex++,this._playAudio&&i.audioValue&&"null"!==i.audioValue&&(s=g.playSound(this._player.templet._path+i.audioValue,1,c.create(this,this._onAniSoundStoped)),g.playbackRate=this._player.playbackRate,s&&this._soundChannelArr.push(s))):i.time<this._player.playStart&&this._playAudio&&i.audioValue&&"null"!==i.audioValue?(this._eventIndex++,s=g.playSound(this._player.templet._path+i.audioValue,1,c.create(this,this._onAniSoundStoped),null,(this._player.currentPlayTime-i.time)/1e3),g.playbackRate=this._player.playbackRate,s&&this._soundChannelArr.push(s)):this._eventIndex++),0==this._aniMode){if(r=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));var n=0,h=0;for(h=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(n=h;n<this._clipIndex;n++)this._createGraphics(n)}else if(1==this._aniMode){if(r=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));for(h=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(n=h;n<this._clipIndex;n++)this._createGraphics(n)}this._createGraphics()}}},r._onAniSoundStoped=function(t){for(var e,i=this._soundChannelArr.length,a=0;a<i;a++)((e=this._soundChannelArr[a]).isStopped||t)&&(e.isStopped||e.stop(),this._soundChannelArr.splice(a,1),i--,a--)},r._createGraphics=function(t){var e,i=(t=-1==(t=void 0===t?-1:t)?this._clipIndex:t)*this._player.cacheFrameRateInterval,a=this._templet.drawOrderAniArr[this._aniClipIndex];if(a&&0<a.length)for(this._drawOrderIndex=0,e=a[this._drawOrderIndex];i>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=a.length));)e=a[this._drawOrderIndex];0!=this._aniMode&&1!=this._aniMode&&this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=xt.create();var s=this.graphics,r=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,i);var n,l,o,u,c=this._aniSectionDic[this._aniClipIndex],d=0,_=0,f=0,m=0,y=0,x=this._templet.srcBoneMatrixArr.length;for(y=c[_=0];_<x;_++)u=this._boneList[_],o=this._templet.srcBoneMatrixArr[_],u.resultTransform.scX=o.scX*this._curOriginalData[d++],u.resultTransform.skX=o.skX+this._curOriginalData[d++],u.resultTransform.skY=o.skY+this._curOriginalData[d++],u.resultTransform.scY=o.scY*this._curOriginalData[d++],u.resultTransform.x=o.x+this._curOriginalData[d++],u.resultTransform.y=o.y+this._curOriginalData[d++],8===this._templet.tMatrixDataLen&&(u.resultTransform.skewX=o.skewX+this._curOriginalData[d++],u.resultTransform.skewY=o.skewY+this._curOriginalData[d++]);var g={},v={};for(y+=c[1];_<y;_++)g[(b=r[_]).name]=this._curOriginalData[d++],v[b.name]=this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++];var D,M={},I={};for(y+=c[2];_<y;_++)M[(b=r[_]).name]=this._curOriginalData[d++],I[b.name]=this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++];if(this._pathDic)for(y+=c[3];_<y;_++){var b=r[_],A=this._pathDic[b.name];if(A)switch(new h(b.extenData).getByte()){case 1:A.position=this._curOriginalData[d++];break;case 2:A.spacing=this._curOriginalData[d++];break;case 3:A.rotateMix=this._curOriginalData[d++],A.translateMix=this._curOriginalData[d++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(p.TEMP.identity()),this._ikArr)for(_=0,y=this._ikArr.length;_<y;_++)D=this._ikArr[_],M.hasOwnProperty(D.name)&&(D.bendDirection=M[D.name]),I.hasOwnProperty(D.name)&&(D.mix=I[D.name]),D.apply();if(this._pathDic)for(var N in this._pathDic)(A=this._pathDic[N]).apply(this._boneList,s);if(this._tfArr)for(_=0,m=this._tfArr.length;_<m;_++)this._tfArr[_].apply();for(_=0,m=this._boneList.length;_<m;_++)if(u=this._boneList[_],l=this._bindBoneBoneSlotDic[u.name],u.resultMatrix.copyTo(this._boneMatrixArray[_]),l)for(f=0,y=l.length;f<y;f++)(n=l[f])&&n.setParentMatrix(u.resultMatrix);var T,C,S,w={};if((c=this._templet.deformAniArr)&&0<c.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,_=0,y=this._boneSlotArray.length;_<y;_++)(n=this._boneSlotArray[_]).deformData=null;var F,k=c[this._aniClipIndex],P=k.default;for(F in this._setDeform(P,w,this._boneSlotArray,i),k)"default"!=F&&F!=this._skinName&&(P=k[F],this._setDeform(P,w,this._boneSlotArray,i));P=k[this._skinName],this._setDeform(P,w,this._boneSlotArray,i)}if(this._drawOrder)for(_=0,y=this._drawOrder.length;_<y;_++)T=g[(n=this._boneSlotArray[this._drawOrder[_]]).name],C=v[n.name],isNaN(C)||(s.save(),s.alpha(C)),isNaN(T)||-2==T||(this._templet.attachmentNames?n.showDisplayByName(this._templet.attachmentNames[T]):n.showDisplayByIndex(T)),w[this._drawOrder[_]]?(S=w[this._drawOrder[_]],n.currDisplayData&&S[n.currDisplayData.attachmentName]?n.deformData=S[n.currDisplayData.attachmentName]:n.deformData=null):n.deformData=null,isNaN(C)?n.draw(s,this._boneMatrixArray,2==this._aniMode):n.draw(s,this._boneMatrixArray,2==this._aniMode,C),isNaN(C)||s.restore();else for(_=0,y=this._boneSlotArray.length;_<y;_++)T=g[(n=this._boneSlotArray[_]).name],C=v[n.name],isNaN(C)||(s.save(),s.alpha(C)),isNaN(T)||-2==T||(this._templet.attachmentNames?n.showDisplayByName(this._templet.attachmentNames[T]):n.showDisplayByIndex(T)),w[_]?(S=w[_],n.currDisplayData&&S[n.currDisplayData.attachmentName]?n.deformData=S[n.currDisplayData.attachmentName]:n.deformData=null):n.deformData=null,isNaN(C)?n.draw(s,this._boneMatrixArray,2==this._aniMode):n.draw(s,this._boneMatrixArray,2==this._aniMode,C),isNaN(C)||s.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,s):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,s)},r._setDeform=function(t,e,i,a){if(t){var s,r,n,h,l=0,o=0;if(t)for(l=0,h=t.deformSlotDataList.length;l<h;l++)for(s=t.deformSlotDataList[l],o=0;o<s.deformSlotDisplayList.length;o++)n=i[(r=s.deformSlotDisplayList[o]).slotIndex],r.apply(a,n),e[r.slotIndex]||(e[r.slotIndex]={}),e[r.slotIndex][r.attachment]=r.deformData}},r.getAnimNum=function(){return this._templet.getAnimationCount()},r.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},r.getSlotByName=function(t){return this._boneSlotDic[t]},r.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},r.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i,a=0;a<this._boneSlotArray.length;a++)this._boneSlotArray[a].showSlotData(null,e);this._templet.showSkinByIndex(this._boneSlotDic,t,e)&&(i=this._templet.skinDataArray[t],this._skinIndex=t,this._skinName=i.name),this._clearCache()},r.showSlotSkinByIndex=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.showDisplayByIndex(e),this._clearCache())},r.showSlotSkinByName=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.showDisplayByName(e),this._clearCache())},r.replaceSlotSkinName=function(t,e,i){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceDisplayByName(e,i),this._clearCache())},r.replaceSlotSkinByIndex=function(t,e,i){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceDisplayByIndex(e,i),this._clearCache())},r.setSlotSkin=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceSkin(e),this._clearCache())},r._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;t<e;t++){for(var i=0,a=this._graphicsCache[t].length;i<a;i++){var s=this._graphicsCache[t][i];s!=this.graphics&&xt.recycle(s)}this._graphicsCache[t].length=0}},r.play=function(t,e,i,a,s,r,h){void 0===i&&(i=!0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r=!0),this._playAudio=h=void 0===h||h,this._indexControl=!1;var l=-1;if(h=NaN,h=e?2147483647:0,"string"==typeof t)for(var o=0,u=this._templet.getAnimationCount();o<u;o++){var c=this._templet.getAnimation(o);if(c&&t==c.name){l=o;break}}else l=t;-1<l&&l<this.getAnimNum()&&(this._aniClipIndex=l,(i||this._pause||this._currAniIndex!=l)&&(this._currAniIndex=l,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(l)),this._drawOrder=null,this._eventIndex=0,this._player.play(l,this._player.playbackRate,h,a,s),r&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=n.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},r.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0),this.timer.clear(this,this._update))},r.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},r.paused=function(){if(!this._pause){if(this._pause=!0,this._player&&(this._player.paused=!0),0<this._soundChannelArr.length)for(var t,e=this._soundChannelArr.length,i=0;i<e;i++)(t=this._soundChannelArr[i]).isStopped||t.pause();this.timer.clear(this,this._update)}},r.resume=function(){if(this._indexControl=!1,this._pause){if(this._pause=!1,this._player&&(this._player.paused=!1),0<this._soundChannelArr.length)for(var t,e=this._soundChannelArr.length,i=0;i<e;i++)(t=this._soundChannelArr[i]).audioBuffer&&t.resume();this._lastTime=n.now(),this.timer.frameLoop(1,this,this._update,null,!0)}},r._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},r._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},r.destroy=function(t){e.prototype.destroy.call(this,t=void 0===t||t),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0)},a(0,r,"url",(function(){return this._aniPath}),(function(t){this.load(t)})),a(0,r,"index",(function(){return this._index}),(function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))})),a(0,r,"total",(function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total})),a(0,r,"templet",(function(){return this._templet})),a(0,r,"player",(function(){return this._player})),s.useSimpleMeshInCanvas=!1,s}(v),bt=(function(e){function s(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,s.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,(this._parentMovieClip=t)?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}i(s,"laya.ani.swf.MovieClip",e);var r=s.prototype;r.destroy=function(t){void 0===t&&(t=!0),this._clear(),e.prototype.destroy.call(this,t)},r._setDisplay=function(t){e.prototype._setDisplay.call(this,t),this._isRoot&&this._$3__onDisplay(t)},r._$3__onDisplay=function(t){t?this.timer.loop(this.interval,this,this.updates,null,!0):this.timer.clear(this,this.updates)},r.updates=function(){if(!this._parentMovieClip){var t=0,e=this._movieClipList.length;for(t=0;t<e;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},r.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]=t},r.removeLabel=function(t){if(t){if(!this._labels)for(var e in this._labels)if(this._labels[e]===t){delete this._labels[e];break}}else this._labels=null},r._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}var t;this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex&&(this._endFrame=-1,null!=this._completeHandler&&(t=this._completeHandler,this._completeHandler=null,t.run()),this.stop())}},r.stop=function(){this._playing=!1},r.gotoAndStop=function(t){this.index=t,this.stop()},r._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){this.timer.clear(this,this.updates);var t=0,e=this._movieClipList.length;for(t=0;t<e;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}for(var i in this._atlasPath&&d.clearRes(this._atlasPath),this._loadedImage)this._loadedImage[i]&&(d.clearRes(i),this._loadedImage[i]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},r.play=function(t,e){void 0===t&&(t=0),this.loop=e=void 0===e||e,this._playing=!0,this._data&&this._displayFrame(t)},r._displayFrame=function(t){-1!=(t=void 0===t?-1:t)&&(this._curIndex>t&&this._reset(),this._parse(t))},r._reset=function(t){(t=void 0===t||t)&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},r._parse=function(t){var e,i=!1,a=this._idOfSprite,r=this._data;for(this._ended&&this._reset(),r.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),r.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(r.getUint16()){case 12:var n,h,l,o,u=r.getUint16(),c=this._ids[r.getUint16()];this._Pos=r.pos,r.pos=c,0==(e=r.getUint8())?(n=r.getUint16(),(h=a[u])||(h=a[u]=new v,(l=new v).loadImage(this.basePath+n+".png"),this._loadedImage[this.basePath+n+".png"]=!0,h.addChild(l),l.size(r.getFloat32(),r.getFloat32()),o=r._getMatrix(),l.transform=o),h.alpha=1):1==e&&((o=a[u])||(a[u]=o=new s(this),o.interval=this.interval,o._ids=this._ids,o.basePath=this.basePath,o._setData(r,c),o._initState(),o.play(0)),o.alpha=1),r.pos=this._Pos;break;case 3:var d=a[r.getUint16()];d&&(this.addChild(d),d.zOrder=r.getUint16(),i=!0);break;case 4:(d=a[r.getUint16()])&&d.removeSelf();break;case 5:a[r.getUint16()][s._ValueList[r.getUint16()]]=r.getFloat32();break;case 6:a[r.getUint16()].visible=0<r.getUint8();break;case 7:var _=(h=a[r.getUint16()]).transform||p.create();_.setTo(r.getFloat32(),r.getFloat32(),r.getFloat32(),r.getFloat32(),r.getFloat32(),r.getFloat32()),h.transform=_;break;case 8:a[r.getUint16()].setPos(r.getFloat32(),r.getFloat32());break;case 9:a[r.getUint16()].setSize(r.getFloat32(),r.getFloat32());break;case 10:a[r.getUint16()].alpha=r.getFloat32();break;case 11:a[r.getUint16()].setScale(r.getFloat32(),r.getFloat32());break;case 98:_=r.getString(),this.event(_),"stop"==_&&this.stop();break;case 99:this._curIndex=r.getUint16(),i&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=r.pos},r._setData=function(t,e){this._data=t,this._start=e+3},r.load=function(e,i,a){void 0===i&&(i=!1),this._url=e,i&&(this._atlasPath=a||e.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this],e=[{url:e,type:"arraybuffer"}],this._atlasPath&&e.push({url:this._atlasPath,type:"atlas"}),t.loader.load(e,c.create(this,this._onLoaded))},r._onLoaded=function(){var t=d.getRes(this._url);t?!this._atlasPath||d.getAtlas(this._atlasPath)?(this.basePath=this._atlasPath?d.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",this._initData(t)):this.event("error","Atlas not find"):this.event("error","file not find")},r._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},r._initData=function(t){this._data=new h(t);var e=0,i=this._data.getUint16();for(e=0;e<i;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||this.timer.loop(this.interval,this,this.updates,null,!0)},r.playTo=function(t,e,i){this._completeHandler=i,this._endFrame=e,this.play(t,!1)},a(0,r,"index",(function(){return this._playIndex}),(function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])})),a(0,r,"count",(function(){return this._count})),a(0,r,"playing",(function(){return this._playing})),a(0,r,"url",null,(function(t){this.load(t)})),s._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"]}(v),function(e){function s(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isParseAudio=!1,this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,s.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}i(s,"laya.ani.bone.Templet",e);var r=s.prototype;return r.loadAni=function(e){this._skBufferUrl=e,t.loader.load(e,c.create(this,this.onComplete),null,"arraybuffer")},r.onComplete=function(t){var e;this._isDestroyed?this.destroy():(e=d.getRes(this._skBufferUrl))?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,e)):this.event("error","load failed:"+this._skBufferUrl)},r.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&m.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},r.buildArmature=function(t){return new It(this,t=void 0===t?0:t)},r.parse=function(t){e.prototype.parse.call(this,t),this._endLoaded(),this._aniVersion===s.LAYA_ANIMATION_VISION?this._isParseAudio=!0:this._aniVersion!=s.LAYA_ANIMATION_160_VISION&&(console.log("[Error] IDE"+this._aniVersion+"->"+s.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},r._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var e=0;this._loadList=[];var i,a=new h(this.getPublicExtData()),s=0,r=a.getInt32(),n=a.readUTFString().split("\n");for(e=0;e<r;e++)i=this._path+n[2*e],n[2*e+1],a.getFloat32(),a.getFloat32(),a.getFloat32(),a.getFloat32(),s=a.getFloat32(),isNaN(s),s=a.getFloat32(),isNaN(s),s=a.getFloat32(),isNaN(s),s=a.getFloat32(),isNaN(s),-1==this._loadList.indexOf(i)&&this._loadList.push(i);t.loader.load(this._loadList,c.create(this,this._textureComplete))}},r._textureComplete=function(){for(var t,e=0,i=this._loadList.length;e<i;e++)t=this._loadList[e],t=this._textureDic[t]=d.getRes(t),m.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},r._parsePublicExtData=function(){var t=0,e=0,i=0,a=0,s=0;for(t=0,s=this.getAnimationCount();t<s;t++)this._graphicsCache.push([]);var r,n,l,o,u,c,d,_,f,m,y="Dragon"!=this._aniClassName,x=new h(this.getPublicExtData()),g=0,v=x.getInt32(),D=x.readUTFString(),I=D.split("\n");for(t=0;t<v;t++){if(f=this._mainTexture,m=this._path+I[2*t],D=I[2*t+1],!(f=null==this._mainTexture?this._textureDic[m]:f))return this.event("error",this),void(this.isParseFail=!0);r=x.getFloat32(),n=x.getFloat32(),l=x.getFloat32(),o=x.getFloat32(),g=x.getFloat32(),u=isNaN(g)?0:g,g=x.getFloat32(),c=isNaN(g)?0:g,g=x.getFloat32(),d=isNaN(g)?l:g,g=x.getFloat32(),_=isNaN(g)?o:g,this.subTextureDic[D]=M.create(f,r,n,l,o,-u,-c,d,_)}this._mainTexture=f;var b,A,N,T,C=x.getUint16();for(t=0;t<C;t++)(b=[]).push(x.getUint16()),b.push(x.getUint16()),b.push(x.getUint16()),b.push(x.getUint16()),this.aniSectionDic[t]=b;var S,w=x.getInt16(),F={};for(t=0;t<w;t++)A=new P,0==t?S=A:A.root=S,A.d=y?-1:1,N=x.readUTFString(),T=x.readUTFString(),A.length=x.getFloat32(),1==x.getByte()&&(A.inheritRotation=!1),1==x.getByte()&&(A.inheritScale=!1),A.name=N,T&&((T=F[T])?T.addChild(A):this.mRootBone=A),F[N]=A,this.mBoneArr.push(A);this.tMatrixDataLen=x.getUint16();var k,U,L=x.getUint16(),R=Math.floor(L/this.tMatrixDataLen),E=this.srcBoneMatrixArr;for(t=0;t<R;t++)(k=new ut).scX=x.getFloat32(),k.skX=x.getFloat32(),k.skY=x.getFloat32(),k.scY=x.getFloat32(),k.x=x.getFloat32(),k.y=x.getFloat32(),8===this.tMatrixDataLen&&(k.skewX=x.getFloat32(),k.skewY=x.getFloat32()),E.push(k),(A=this.mBoneArr[t]).transform=k;var K,X,q=x.getUint16();for(t=0;t<q;t++){for(U=new H,K=x.getUint16(),e=0;e<K;e++)U.boneNames.push(x.readUTFString()),U.boneIndexs.push(x.getInt16());U.name=x.readUTFString(),U.targetBoneName=x.readUTFString(),U.targetBoneIndex=x.getInt16(),U.bendDirection=x.getFloat32(),U.mix=x.getFloat32(),U.isSpine=y,this.ikArr.push(U)}var G,Q,Z=x.getUint16();for(t=0;t<Z;t++){for(X=new lt,G=x.getUint16(),e=0;e<G;e++)X.boneIndexs.push(x.getInt16());X.name=x.getUTFString(),X.targetIndex=x.getInt16(),X.rotateMix=x.getFloat32(),X.translateMix=x.getFloat32(),X.scaleMix=x.getFloat32(),X.shearMix=x.getFloat32(),X.offsetRotation=x.getFloat32(),X.offsetX=x.getFloat32(),X.offsetY=x.getFloat32(),X.offsetScaleX=x.getFloat32(),X.offsetScaleY=x.getFloat32(),X.offsetShearY=x.getFloat32(),this.tfArr.push(X)}var j,$=x.getUint16();for(t=0;t<$;t++){for((Q=new J).name=x.readUTFString(),j=x.getUint16(),e=0;e<j;e++)Q.bones.push(x.getInt16());Q.target=x.readUTFString(),Q.positionMode=x.readUTFString(),Q.spacingMode=x.readUTFString(),Q.rotateMode=x.readUTFString(),Q.offsetRotation=x.getFloat32(),Q.position=x.getFloat32(),Q.spacing=x.getFloat32(),Q.rotateMix=x.getFloat32(),Q.translateMix=x.getFloat32(),this.pathArr.push(Q)}var tt,it,rt,nt,ht,ot,ct,dt,_t,pt,ft=x.getInt16();for(t=0;t<ft;t++){var mt=x.getUint8(),yt={};this.deformAniArr.push(yt);for(var xt=0;xt<mt;xt++)for((ot=new O).skinName=x.getUTFString(),yt[ot.skinName]=ot,tt=x.getInt16(),e=0;e<tt;e++)for(ct=new V,ot.deformSlotDataList.push(ct),it=x.getInt16(),i=0;i<it;i++)for(dt=new Y,ct.deformSlotDisplayList.push(dt),dt.slotIndex=x.getInt16(),dt.attachment=x.getUTFString(),rt=x.getInt16(),a=0;a<rt;a++)for(1==x.getByte()?dt.tweenKeyList.push(!0):dt.tweenKeyList.push(!1),nt=x.getFloat32(),dt.timeList.push(nt),dt.vectices.push(_t=[]),ht=x.getInt16(),s=0;s<ht;s++)_t.push(x.getFloat32())}var gt,vt,Dt,Mt,It=x.getInt16();for(t=0;t<It;t++){for(gt=x.getInt16(),pt=[],e=0;e<gt;e++){for((vt=new W).time=x.getFloat32(),Dt=x.getInt16(),i=0;i<Dt;i++)vt.drawOrder.push(x.getInt16());pt.push(vt)}this.drawOrderAniArr.push(pt)}var bt,At,Nt=x.getInt16();for(t=0;t<Nt;t++){for(bt=x.getInt16(),Mt=[],e=0;e<bt;e++)(At=new z).name=x.getUTFString(),this._isParseAudio&&(At.audioValue=x.getUTFString()),At.intValue=x.getInt32(),At.floatValue=x.getFloat32(),At.stringValue=x.getUTFString(),At.time=x.getFloat32(),Mt.push(At);this.eventAniArr.push(Mt)}var Tt=x.getInt16();if(0<Tt)for(this.attachmentNames=[],t=0;t<Tt;t++)this.attachmentNames.push(x.getUTFString());var Ct,St,wt=x.getInt16();for(t=0;t<wt;t++)(Ct=new B).name=x.readUTFString(),Ct.parent=x.readUTFString(),Ct.attachmentName=x.readUTFString(),Ct.srcDisplayIndex=Ct.displayIndex=x.getInt16(),(Ct.templet=this).boneSlotDic[Ct.name]=Ct,null==(St=this.bindBoneBoneSlotDic[Ct.parent])&&(this.bindBoneBoneSlotDic[Ct.parent]=St=[]),St.push(Ct),this.boneSlotArray.push(Ct);var Ft,kt,Pt,Bt,Ut,Lt,Rt,Ot,Et,Vt,Kt=x.readUTFString().split("\n"),Yt=0,Wt=x.getUint8();for(t=0;t<Wt;t++){for((Ft=new et).name=Kt[Yt++],Bt=x.getUint8(),e=0;e<Bt;e++){for((kt=new st).name=Kt[Yt++],Ct=this.boneSlotDic[kt.name],Ut=x.getUint8(),i=0;i<Ut;i++){if(Pt=new at,this.skinSlotDisplayDataArr.push(Pt),Pt.name=Kt[Yt++],Pt.attachmentName=Kt[Yt++],Pt.transform=new ut,Pt.transform.scX=x.getFloat32(),Pt.transform.skX=x.getFloat32(),Pt.transform.skY=x.getFloat32(),Pt.transform.scY=x.getFloat32(),Pt.transform.x=x.getFloat32(),Pt.transform.y=x.getFloat32(),kt.displayArr.push(Pt),Pt.width=x.getFloat32(),Pt.height=x.getFloat32(),Pt.type=x.getUint8(),Pt.verLen=x.getUint16(),0<(w=x.getUint16()))for(Pt.bones=[],a=0;a<w;a++){var Xt=x.getUint16();Pt.bones.push(Xt)}if(0<(Lt=x.getUint16()))for(Pt.uvs=[],a=0;a<Lt;a++)Pt.uvs.push(x.getFloat32());if(0<(Rt=x.getUint16()))for(Pt.weights=[],a=0;a<Rt;a++)Pt.weights.push(x.getFloat32());if(0<(Ot=x.getUint16()))for(Pt.triangles=[],a=0;a<Ot;a++)Pt.triangles.push(x.getUint16());if(0<(Et=x.getUint16()))for(Pt.vertices=[],a=0;a<Et;a++)Pt.vertices.push(x.getFloat32());if(0<(Vt=x.getUint16()))for(Pt.lengths=[],a=0;a<Vt;a++)Pt.lengths.push(x.getFloat32())}Ft.slotArr.push(kt)}this.skinDic[Ft.name]=Ft,this.skinDataArray.push(Ft)}1==x.getUint8()?(this.yReverseMatrix=new p(1,0,0,-1,0,0),S&&S.setTempMatrix(this.yReverseMatrix)):S&&S.setTempMatrix(new p),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},r.getTexture=function(t){var e=this.subTextureDic[t];return null==(e=e||this.subTextureDic[t.substr(0,t.length-1)])?this._mainTexture:e},r.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),e<0&&e>=this.skinDataArray.length)return!1;var a,s,r,n=0,h=this.skinDataArray[e];if(h){for(n=0,a=h.slotArr.length;n<a;n++)(r=h.slotArr[n])&&(s=t[r.name])&&(s.showSlotData(r,i),i&&"undefined"!=s.attachmentName&&"null"!=s.attachmentName?s.showDisplayByName(s.attachmentName):s.showDisplayByIndex(s.displayIndex));return!0}return!1},r.getSkinIndexByName=function(t){for(var e=0,i=this.skinDataArray.length;e<i;e++)if(this.skinDataArray[e].name==t)return e;return-1},r.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t]&&this._graphicsCache[t][e]?this._graphicsCache[t][e]:null},r.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},r.destroy=function(){var t,e;for(e in this._isDestroyed=!0,this.subTextureDic)(t=this.subTextureDic[e])&&t.destroy();for(e in this._textureDic)(t=this._textureDic[e])&&t.destroy();for(var i=0,a=this.skinSlotDisplayDataArr.length;i<a;i++)this.skinSlotDisplayDataArr[i].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete s.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},r.getAniNameByIndex=function(t){return(t=this.getAnimation(t))?t.name:null},a(0,r,"rate",(function(){return this._rate}),(function(t){this._rate=t})),s.LAYA_ANIMATION_160_VISION="LAYAANIMATION:1.6.0",s.LAYA_ANIMATION_VISION="LAYAANIMATION:1.7.0",s.TEMPLET_DICTIONARY=null,s}(Dt))}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],(function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var a=Laya[i];a&&a.__isclass&&(e[i]=a)}}));