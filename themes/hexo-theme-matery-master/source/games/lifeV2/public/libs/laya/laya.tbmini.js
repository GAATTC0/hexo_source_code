!function(i,e,t){t.un,t.uns;var n=t.static,o=t.class,a=t.getset,s=(t.__newvec,laya.utils.Browser),l=t.Config,r=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,d=laya.utils.Handler,c=laya.display.Input,f=laya.net.Loader,h=laya.net.LocalStorage,v=(laya.maths.Matrix,laya.renders.Render),p=laya.net.ResourceVersion,m=laya.utils.RunDriver,y=laya.media.SoundChannel,_=laya.media.SoundManager,g=laya.net.URL,w=laya.utils.Utils,F=function(){function i(){}return o(i,"laya.tb.mini.MiniFileMgr",null,"MiniFileMgr$10"),i.isLocalNativeFile=function(i){for(var e=0,t=S.nativefiles.length;e<t;e++)if(-1!=i.indexOf(S.nativefiles[e]))return!0;return!1},i.isSubNativeFile=function(i){for(var e=0,t=S.subNativeheads.length;e<t;e++)if(-1!=i.indexOf(S.subNativeheads[e]))return!0;return!1},i.getFileInfo=function(e){var t=e,n=i.fakeObj[t];return null==n?null:n},i.read=function(e,t,n,o,a,s){var l;void 0===t&&(t="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===s&&(s=""),l=""==o||-1==o.indexOf("http://")&&-1==o.indexOf("https://")?e:i.getFileNativePath(e),i.fs.readFile({filePath:l,encoding:t,success:function(i){null!=n&&n.runWith([0,i])},fail:function(e){e&&""!=o?i.downFiles(o,t,n,o,a,s):null!=n&&n.runWith([1])}})},i.downFiles=function(e,t,n,o,a,s,l){void 0===t&&(t="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===s&&(s=""),void 0===l&&(l=!0),i.wxdown({url:e,success:function(r){r.hasOwnProperty("statusCode")||(r.statusCode=200),200===r.statusCode?i.readFile(r.apFilePath,t,n,o,a,s,l):403===r.statusCode?null!=n&&n.runWith([0,e]):null!=n&&n.runWith([1,r])},fail:function(i){null!=n&&n.runWith([1,i])}}).onProgressUpdate((function(i){null!=n&&n.runWith([2,i.progress])}))},i.readFile=function(e,t,n,o,a,s,l){void 0===t&&(t="utf8"),void 0===o&&(o=""),void 0===a&&(a=!1),void 0===s&&(s=""),void 0===l&&(l=!0),i.fs.readFile({filePath:e,encoding:t,success:function(s){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||!a?null!=n&&n.runWith([0,s]):(null!=n&&n.runWith([0,s]),i.copyFile(e,o,null,t,l))},fail:function(i){i&&null!=n&&n.runWith([1,i])}})},i.downOtherFiles=function(e,t,n,o,a){void 0===n&&(n=""),void 0===o&&(o=!1),void 0===a&&(a=!0),i.wxdown({url:e,success:function(e){e.hasOwnProperty("statusCode")||(e.statusCode=200),200===e.statusCode?o&&-1==n.indexOf(".php")?(null!=t&&t.runWith([0,e.apFilePath]),i.copyFile(e.apFilePath,n,null,"",a)):null!=t&&t.runWith([0,e.apFilePath]):null!=t&&t.runWith([1,e])},fail:function(i){null!=t&&t.runWith([1,i])}})},i.downLoadFile=function(e,n,o,a,l){void 0===n&&(n=""),void 0===a&&(a="utf8"),void 0===l&&(l=!1),s.window.hasOwnProperty("my")?t.loader.load(e,o):"image"==n||"sound"==n?i.downOtherFiles(e,o,e,l,!1):i.downFiles(e,a,o,e,!0,n,l)},i.copyFile=function(e,t,n,o,a){void 0===o&&(o=""),void 0===a&&(a=!0);var l=e.split("/"),r=l[l.length-1],u=i.getFileInfo(t),d=i.getFileNativePath(r);i.fakeObj[t]={md5:r,readyUrl:t,size:0,times:s.now(),encoding:o};var c=52428800,f=4194304,h=i.getCacheUseSize();u?u.readyUrl!=t?i.fs.getFileInfo({filePath:e,success:function(s){a&&h+f+s.size>=c&&(s.size>S.minClearSize&&(S.minClearSize=s.size),i.onClearCacheRes()),i.deleteFile(e,t,n,o,s.size)},fail:function(i){null!=n&&n.runWith([1,i])}}):null!=n&&n.runWith([0]):i.fs.getFileInfo({filePath:e,success:function(s){a&&h+f+s.size>=c&&(s.size>S.minClearSize&&(S.minClearSize=s.size),i.onClearCacheRes()),i.fs.copyFile({srcPath:e,destPath:d,success:function(e){i.onSaveFile(t,r,!0,o,n,s.size)},fail:function(i){null!=n&&n.runWith([1,i])}})},fail:function(i){null!=n&&n.runWith([1,i])}})},i.onClearCacheRes=function(){var e=S.minClearSize,t=[];for(var n in i.filesListObj)"fileUsedSize"!=n&&t.push(i.filesListObj[n]);i.sortOn(t,"times",16);for(var o=0,a=1,s=t.length;a<s;a++){var l=t[a];if(o>=e)break;o+=l.size,i.deleteFile("",l.readyUrl)}},i.sortOn=function(i,e,t){return void 0===t&&(t=0),16==t?i.sort((function(i,t){return i[e]-t[e]})):18==t?i.sort((function(i,t){return t[e]-i[e]})):i.sort((function(i,t){return i[e]-t[e]}))},i.getFileNativePath=function(i){return laya.tb.mini.MiniFileMgr.fileNativeDir+"/"+i},i.deleteFile=function(e,t,n,o,a){void 0===t&&(t=""),void 0===o&&(o=""),void 0===a&&(a=0);var s=i.getFileInfo(t),l=i.getFileNativePath(s.md5);i.fs.unlink({filePath:l,success:function(s){var l=""!=e;if(""!=e){var r=i.getFileNativePath(e);i.fs.copyFile({srcPath:e,destPath:r,success:function(a){i.onSaveFile(t,e,l,o,n,a.size)},fail:function(i){null!=n&&n.runWith([1,i])}})}else i.onSaveFile(t,e,l,o,n,a)},fail:function(i){}})},i.deleteAll=function(){var e=[];for(var t in i.filesListObj)"fileUsedSize"!=t&&e.push(i.filesListObj[t]);for(var n=1,o=e.length;n<o;n++){var a=e[n];i.deleteFile("",a.readyUrl)}laya.tb.mini.MiniFileMgr.filesListObj&&laya.tb.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.tb.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.tb.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},i.onSaveFile=function(e,t,n,o,a,l){void 0===n&&(n=!0),void 0===o&&(o=""),void 0===l&&(l=0);var r=e;if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),n)i.getFileNativePath(t),i.filesListObj[r]={md5:t,readyUrl:e,size:l,times:s.now(),encoding:o},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+l,i.writeFilesList(r,JSON.stringify(i.filesListObj),!0),null!=a&&a.runWith([0]);else if(i.filesListObj[r]){var u=parseInt(i.filesListObj[r].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-u,i.filesListObj[r].md5==i.fakeObj[r].md5&&delete i.fakeObj[r],delete i.filesListObj[r],i.writeFilesList(r,JSON.stringify(i.filesListObj),!1),null!=a&&a.runWith([0])}},i.writeFilesList=function(e,t,n){var o=i.fileNativeDir+"/"+i.fileListName;i.fs.writeFile({filePath:o,encoding:"utf8",data:t,success:function(i){},fail:function(i){}}),!S.isZiYu&&S.isPosMsgYu&&S.window.my.postMessage&&S.window.my.postMessage({url:e,data:i.filesListObj[e],isLoad:"filenative",isAdd:n})},i.getCacheUseSize=function(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0},i.existDir=function(e,t){i.fs.mkdir({dirPath:e,success:function(i){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(e){10025==e.error?i.readSync(i.fileListName,"utf8",t):null!=t&&t.runWith([1,e])}})},i.readSync=function(e,t,n,o){void 0===t&&(t="utf8"),void 0===o&&(o="");var a,s=i.getFileNativePath(e);try{i.fs.readFile({filePath:s,encoding:t,success:function(i){a=i.data,null!=n&&n.runWith([0,{data:a}])},fail:function(){null!=n&&n.runWith([1])}})}catch(i){null!=n&&n.runWith([1])}},i.setNativeFileDir=function(e){i.fileNativeDir=S.window.my.env.USER_DATA_PATH+e},i.filesListObj={},i.fakeObj={},i.fileNativeDir=null,i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16,n(i,["fs",function(){return this.fs=S.window.my.getFileSystemManager()},"wxdown",function(){return this.wxdown=S.window.my.downloadFile}]),i}(),C=function(){function i(){}return o(i,"laya.tb.mini.MiniImage",null,"MiniImage$10"),i.prototype._loadImage=function(e){var t=this;if(e=g.formatURL(e),F.isLocalNativeFile(e)||-1==e.indexOf("http://")&&-1==e.indexOf("https://"))if(-1!=e.indexOf(S.window.my.env.USER_DATA_PATH))i.onCreateImage(e,t,!1,e);else{if(""!=F.loadPath)e=e.split(F.loadPath)[1];else{var n=""!=g.rootPath?g.rootPath:g.basePath,o=e;""!=n&&(e=e.split(n)[1]),e||(e=o)}i.onCreateImage(e,t,!0)}else i.onCreateImage(e,t,!1,encodeURI(e))},i.onCreateImage=function(i,e,t,n){var o,a;function l(){a.onload=null,a.onerror=null,delete e.imgCache[i]}void 0===t&&(t=!1),void 0===n&&(n=""),o=t?F.isSubNativeFile(i)?i:S.baseDir+i:""!=n?n:i,null==e.imgCache&&(e.imgCache={});var r=function(){l(),e.onLoaded(a)},d=function(){l(),delete F.filesListObj[i],delete F.fakeObj[i],e.event("error","Load image failed")};"nativeimage"==e._type?((a=new s.window.Image).crossOrigin="",a.onload=r,a.onerror=d,a.src=o,e.imgCache[i]=a):new u.create(o,{onload:r,onerror:d,onCreate:function(t){a=t,e.imgCache[i]=t}})},i}(),E=function(){function i(){}return o(i,"laya.tb.mini.MiniInput",null,"MiniInput$10"),i._createInputElement=function(){c._initInput(c.area=s.createElement("textarea")),c._initInput(c.input=s.createElement("input")),c.inputContainer=s.createElement("div"),c.inputContainer.style.position="absolute",c.inputContainer.style.zIndex=1e5,s.container.appendChild(c.inputContainer),c.inputContainer.setPos=function(i,e){c.inputContainer.style.left=i+"px",c.inputContainer.style.top=e+"px"},_._soundClass=O,_._musicClass=O;var i=S.systemInfo.model,e=S.systemInfo.system;-1!=i.indexOf("iPhone")&&(s.onIPhone=!0,s.onIOS=!0,s.onIPad=!0,s.onAndroid=!1),-1==e.indexOf("Android")&&-1==e.indexOf("Adr")||(s.onAndroid=!0,s.onIPhone=!1,s.onIOS=!1,s.onIPad=!1)},i._onStageResize=function(){t.stage._canvasTransform.identity().scale(s.width/v.canvas.width/m.getPixelRatio(),s.height/v.canvas.height/m.getPixelRatio())},i.wxinputFocus=function(i){},i.inputEnter=function(i){},i.wxinputblur=function(){},i.hideKeyboard=function(){},i}(),b=function(){function i(){}return o(i,"laya.tb.mini.MiniLocalStorage",null,"MiniLocalStorage$9"),i.__init__=function(){i.items=i},i.setItem=function(i,e){try{S.window.my.setStorageSync({key:i,data:e})}catch(t){S.window.my.setStorage({key:i,data:e})}},i.getItem=function(i){var e=S.window.my.getStorageSync({key:i});return e.success?e.data:null},i.setJSON=function(e,t){i.setItem(e,t)},i.getJSON=function(e){return i.getItem(e)},i.removeItem=function(i){S.window.my.removeStorageSync(i)},i.clear=function(){S.window.my.clearStorageSync()},i.getStorageInfoSync=function(){try{var i=S.window.my.getStorageInfoSync();return console.log(i.keys),console.log(i.currentSize),console.log(i.limitSize),i}catch(i){}return null},i.support=!0,i.items=null,i}(),S=(function(){function i(){}o(i,"laya.tb.mini.MiniLocation",null,"MiniLocation$10"),i.__init__=function(){S.window.navigator.geolocation.getCurrentPosition=i.getCurrentPosition,S.window.navigator.geolocation.watchPosition=i.watchPosition,S.window.navigator.geolocation.clearWatch=i.clearWatch},i.getCurrentPosition=function(i,e,t){var n;(n={}).success=function(e){null!=i&&i(e)},n.fail=e,S.window.my.getLocation(n)},i.watchPosition=function(e,n,o){var a;return i._curID++,(a={}).success=e,a.error=n,i._watchDic[i._curID]=a,t.timer.loop(1e3,null,i._myLoop),i._curID},i.clearWatch=function(e){delete i._watchDic[e],i._hasWatch()||t.timer.clear(null,i._myLoop)},i._hasWatch=function(){var e;for(e in i._watchDic)if(i._watchDic[e])return!0;return!1},i._myLoop=function(){i.getCurrentPosition(i._mySuccess,i._myError)},i._mySuccess=function(e){var t,n={};for(t in n.coords=e,n.timestamp=s.now(),i._watchDic)i._watchDic[t].success&&i._watchDic[t].success(n)},i._myError=function(e){var t;for(t in i._watchDic)i._watchDic[t].error&&i._watchDic[t].error(e)},i._watchDic={},i._curID=0}(),function(){function i(i,e){this.videoend=!1,this.videourl="",this.videoElement=null,this.onPlayFunc=null,this.onEndedFunC=null,this._duration=NaN,this.position=NaN,void 0===i&&(i=320),void 0===e&&(e=240),this.videoElement=S.window.my.createVideo({width:i,height:e,autoplay:!0})}o(i,"laya.tb.mini.MiniVideo",null,"MiniVideo$8");var e=i.prototype;e.on=function(i,e,t){"loadedmetadata"==i?(this.onPlayFunc=t.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=t.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},e.onTimeUpdateFunc=function(i){this.position=i.position,this._duration=i.duration},e.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()},e.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())},e.off=function(i,e,t){"loadedmetadata"==i?(this.onPlayFunc=t.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=t.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},e.load=function(i){this.videoElement&&(this.videoElement.src=i)},e.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},e.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},e.size=function(i,e){this.videoElement&&(this.videoElement.width=i,this.videoElement.height=e)},e.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},e.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},a(0,e,"duration",(function(){return this._duration})),a(0,e,"paused",(function(){return!!this.videoElement&&this.videoElement.paused})),a(0,e,"loop",(function(){return!!this.videoElement&&this.videoElement.loop}),(function(i){this.videoElement&&(this.videoElement.loop=i)})),a(0,e,"currentTime",(function(){return this.videoElement?this.videoElement.initialTime:0}),(function(i){this.videoElement&&(this.videoElement.initialTime=i)})),a(0,e,"ended",(function(){return this.videoend})),a(0,e,"muted",(function(){return!!this.videoElement&&this.videoElement.muted}),(function(i){this.videoElement&&(this.videoElement.muted=i)})),a(0,e,"videoWidth",(function(){return this.videoElement?this.videoElement.width:0})),a(0,e,"videoHeight",(function(){return this.videoElement?this.videoElement.height:0})),a(0,e,"playbackRate",(function(){return this.videoElement?this.videoElement.playbackRate:0}),(function(i){this.videoElement&&(this.videoElement.playbackRate=i)})),a(0,e,"x",(function(){return this.videoElement?this.videoElement.x:0}),(function(i){this.videoElement&&(this.videoElement.x=i)})),a(0,e,"y",(function(){return this.videoElement?this.videoElement.y:0}),(function(i){this.videoElement&&(this.videoElement.y=i)})),a(0,e,"currentSrc",(function(){return this.videoElement.src})),i.__init__=function(){laya.device.media.Video=i}}(),function(){function e(){}return o(e,"laya.tb.mini.TBMiniAdapter"),e.getJson=function(i){return JSON.parse(i)},e.init=function(){if(!e._inited){e._inited=!0,e.window=i;var n=e.window.navigator.userAgent;(n.indexOf("TB")>-1||n.indexOf("Taobao")>-1||n.indexOf("TM/")>-1)&&(e.EnvConfig={},F.setNativeFileDir("/layaairGame"),F.existDir(F.fileNativeDir,d.create(e,e.onMkdirCallBack)),e.systemInfo=e.window.my.getSystemInfoSync(),e.window.focus=function(){},t._getUrlPath=function(){},t.getUrlPath=function(){},e.window.logtime=function(i){},e.window.alertTimeLog=function(i){},e.window.resetShareInfo=function(){},e._preCreateElement=s.createElement,s.createElement=e.createElement,e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e._preCreateElement("canvas").getContext("2d").__proto__,e.window.document.body.appendChild=function(){},m.createShaderCondition=e.createShaderCondition,w.parseXMLFromString=e.parseXMLFromString,c._createInputElement=E._createInputElement,e.EnvConfig.load=f.prototype.load,f.prototype.load=L.prototype.load,f.prototype._loadImage=C.prototype._loadImage,h._baseClass=b,b.__init__(),l.useRetinalCanvas=!0)}},e.measureText=function(i){var t=e._measureText(i);return t||(t={width:16},console.warn("-------微信获取文字宽度失败----等待修复---------")),t},e.getUrlEncode=function(i,e){return"arraybuffer"==e?"":"utf8"},e.downLoadFile=function(i,e,t,n){void 0===e&&(e=""),void 0===n&&(n="utf8"),F.getFileInfo(i)?null!=t&&t.runWith([0]):F.downLoadFile(i,e,t,n)},e.remove=function(i,e){F.deleteFile("",i,e,"",0)},e.removeAll=function(){F.deleteAll()},e.hasNativeFile=function(i){return F.isLocalNativeFile(i)},e.getFileInfo=function(i){return F.getFileInfo(i)},e.getFileList=function(){return F.filesListObj},e.exitMiniProgram=function(){e.window.my.exitMiniProgram()},e.onMkdirCallBack=function(i,e){i||(F.filesListObj=JSON.parse(e.data),F.fakeObj=JSON.parse(e.data))},e.pixelRatio=function(){if(!e.EnvConfig.pixelRatioInt)try{return e.EnvConfig.pixelRatioInt=e.systemInfo.pixelRatio,e.systemInfo.pixelRatio}catch(i){}return e.EnvConfig.pixelRatioInt},e.createElement=function(i){var t;if("canvas"==i)return!(t=1==e.idx?e.window.canvas.getRealCanvas():e._preCreateElement(i)).style&&(t.style={}),e.idx++,t;if("textarea"==i||"input"==i)return e.onCreateInput(i);if("div"==i){var n=e._preCreateElement(i);return n.contains=function(i){return null},n.removeChild=function(i){},n}return e._preCreateElement(i)},e.onCreateInput=function(i){var t=e._preCreateElement(i);return t.focus=E.wxinputFocus,t.blur=E.wxinputblur,t.value=0,t.placeholder={},t.type={},t.setColor=function(i){},t.setType=function(i){},t.setFontFace=function(i){},t.contains=function(i){return null},t},e.createShaderCondition=function(i){var e=this;return function(){return e[i.replace("this.","")]}},e.EnvConfig=null,e.window=null,e._preCreateElement=null,e._inited=!1,e.systemInfo=null,e.isPosMsgYu=!1,e.autoCacheFile=!0,e.minClearSize=5242880,e.subNativeFiles={},e.subNativeheads=[],e.subMaps=[],e.AutoCacheDownFile=!1,e.baseDir="pages/index/",e._measureText=null,e.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new i.Parser.DOMParser).parseFromString(e,"text/xml")}catch(i){throw"需要引入xml解析库文件"}return t},e.idx=1,n(e,["nativefiles",function(){return this.nativefiles=["layaNativeDir"]}]),e}()),L=(function(i){function e(){e.__super.call(this)}o(e,"laya.tb.mini.MiniAccelerator",i,"MiniAccelerator$10");var t=e.prototype;t.on=function(t,n,o,a){return i.prototype.on.call(this,t,n,o,a),e.startListen(this.onDeviceOrientationChange),this},t.off=function(t,n,o,a){return void 0===a&&(a=!1),this.hasListener(t)||e.stopListen(),i.prototype.off.call(this,t,n,o,a)},e.__init__=function(){try{var i;if(!(i=laya.device.motion.Accelerator))return;i.prototype.on=e.prototype.on,i.prototype.off=e.prototype.off}catch(i){}},e.startListen=function(i){if(e._callBack=i,!e._isListening){e._isListening=!0;try{S.window.my.onAccelerometerChange(laya.tb.mini.MiniAccelerator.onAccelerometerChange)}catch(i){}}},e.stopListen=function(){e._isListening=!1;try{S.window.my.stopAccelerometer({})}catch(i){}},e.onAccelerometerChange=function(i){var t;(t={}).acceleration=i,t.accelerationIncludingGravity=i,t.rotationRate={},null!=e._callBack&&e._callBack(t)},e._isListening=!1,e._callBack=null}(r),function(i){function e(){e.__super.call(this)}return o(e,"laya.tb.mini.MiniLoader",i,"MiniLoader$10"),e.prototype.load=function(i,t,n,o,a){void 0===n&&(n=!0),void 0===a&&(a=!1);var s=this;if(s._url=i,0===i.indexOf("data:image")?s._type=t="image":s._type=t||(t=s.getTypeFromUrl(i)),s._cache=n,s._data=null,!a&&f.loadedMap[g.formatURL(i)])return s._data=f.loadedMap[g.formatURL(i)],this.event("progress",1),void this.event("complete",s._data);if(null!=f.parserMap[t])return s._customParse=!0,void(f.parserMap[t]instanceof laya.utils.Handler?f.parserMap[t].runWith(this):f.parserMap[t].call(null,this));if(F.isLocalNativeFile(i)&&!F.getFileInfo(i)){if(S.subNativeFiles&&0==S.subNativeheads.length)for(var l in S.subNativeFiles){var r=S.subNativeFiles[l];S.subNativeheads=S.subNativeheads.concat(r);for(var u=0;u<r.length;u++)S.subMaps[r[u]]=l+"/"+r[u]}if(S.subNativeFiles&&-1!=i.indexOf("/")){var c=i.split("/")[0]+"/";if(c&&-1!=S.subNativeheads.indexOf(c)){var h=S.subMaps[c];i=i.replace(c,h)}}}var v=S.getUrlEncode(i,t),m=w.getFileExtension(i);if(-1!=e._fileTypeArr.indexOf(m)||"image"==t)S.EnvConfig.load.call(this,i,t,n,o,a);else if(F.getFileInfo(i)){var y=F.getFileInfo(g.formatURL(i));y.encoding=null==y.encoding?"utf8":y.encoding;var _=F.getFileNativePath(y.md5);F.readFile(_,y.encoding,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s]),i)}else F.isLocalNativeFile(i)?F.isSubNativeFile(i)?F.readFile(p.addVersionPrefix(i),v,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s])):F.readFile(S.baseDir+p.addVersionPrefix(i),v,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s])):(g.formatURL(i),(y=F.getFileInfo(i))?(y.encoding=null==y.encoding?"utf8":y.encoding,F.readFile(y.url,v,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s]),i)):(i=g.formatURL(i),"image"!=t&&-1==i.indexOf("http://")&&-1==i.indexOf("https://")?F.readFile(S.baseDir+i,v,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s]),i):F.downFiles(encodeURI(i),v,new d(e,e.onReadNativeCallBack,[v,i,t,n,o,a,s]),i,S.AutoCacheDownFile)))},e.onReadNativeCallBack=function(i,e,t,n,o,a,s,l,r){var u;void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===l&&(l=0),l?1==l&&s.onError&&s.onError(r):(u="json"==t||"atlas"==t?S.getJson(r.data):"xml"==t?w.parseXMLFromString(r.data):r.data,s.onLoaded(u))},n(e,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e}(r)),O=function(i){function e(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,e.__super.call(this),this._sound=e._createSound()}o(e,"laya.tb.mini.MiniSound",i,"MiniSound$10");var t=e.prototype;return t.load=function(i){if(F.isLocalNativeFile(i)){if(-1!=i.indexOf("http://")||-1!=i.indexOf("https://"))if(""!=F.loadPath)i=i.split(F.loadPath)[1];else{var e=""!=g.rootPath?g.rootPath:g.basePath;""!=e&&(i=i.split(e)[1])}}else i=g.formatURL(i);if(this.url=i,this.readyUrl=i,S.autoCacheFile&&F.getFileInfo(i))this.onDownLoadCallBack(i,0);else if(S.autoCacheFile)if(F.isLocalNativeFile(i)){var t=i;if(""!=(e=""!=g.rootPath?g.rootPath:g.basePath)&&(i=i.split(e)[1]),i||(i=t),S.subNativeFiles&&0==S.subNativeheads.length)for(var n in S.subNativeFiles){var o=S.subNativeFiles[n];S.subNativeheads=S.subNativeheads.concat(o);for(var a=0;a<o.length;a++)S.subMaps[o[a]]=n+"/"+o[a]}if(S.subNativeFiles&&-1!=i.indexOf("/")){var s=i.split("/")[0]+"/";if(s&&-1!=S.subNativeheads.indexOf(s)){var l=S.subMaps[s];i=i.replace(s,l)}}this.onDownLoadCallBack(i,0)}else-1==i.indexOf("http://")&&-1==i.indexOf("https://")||-1!=i.indexOf(S.window.my.env.USER_DATA_PATH)?this.onDownLoadCallBack(i,0):F.downOtherFiles(i,d.create(this,this.onDownLoadCallBack,[i]),i,S.autoCacheFile);else this.onDownLoadCallBack(i,0)},t.onDownLoadCallBack=function(i,e,t){var n;if(void 0===t&&(t=""),!e&&this._sound)if(S.autoCacheFile){if(""==t)if(F.isLocalNativeFile(i)){var o=""!=g.rootPath?g.rootPath:g._basePath,a=i;""==o||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(n=i.split(o)[1]),n||(n=a),n=F.isSubNativeFile(n)?n:S.baseDir+n}else{var s=F.getFileInfo(i);if(s&&s.md5){var l=s.md5;n=F.getFileNativePath(l)}else n=-1==i.indexOf("http://")&&-1==i.indexOf("https://")&&-1==i.indexOf(S.window.my.env.USER_DATA_PATH)?S.baseDir+i:i}else n=t;this._sound.src=this.url=n}else(F.isLocalNativeFile(i)&&!F.isSubNativeFile(i)||-1==i.indexOf("http://")&&-1==i.indexOf("https://")&&-1==i.indexOf(S.window.my.env.USER_DATA_PATH))&&(i=S.baseDir+i),this._sound.src=i;else this.event("error")},t.play=function(i,e){if(void 0===i&&(i=0),void 0===e&&(e=0),!this.url)return null;var t=new P(this);return t.url=this.url,t.loops=e,t.loop=0===e,t.startTime=i,t.isStopped=!1,_.addChannel(t),t},t.dispose=function(){this._sound&&(this._sound.src="",e._audioCache.push(this._sound),this._sound=null,this.readyUrl=this.url=null)},a(0,t,"duration",(function(){return this._sound.duration})),e._createSound=function(){return e._audioCache.length?e._audioCache.pop():(e._id++,S.window.my.createInnerAudioContext())},e._id=0,e._audioCache=[],e}(r),P=function(i){function e(i){this._audio=null,this._onEnd=null,this._onCanplay=null,this._onError=null,this._miniSound=null,e.__super.call(this),this._audio=i._sound,this._miniSound=i,this._onEnd=e.bindToThis(this.__onEnd,this),this._onCanplay=e.bindToThis(this.onCanPlay,this),this._onError=e.bindToThis(this.onError,this),this.addEventListener()}o(e,"laya.tb.mini.MiniSoundChannel",i,"MiniSoundChannel$10");var n=e.prototype;return n.addEventListener=function(){this._audio.onError(this._onError),this._audio.onCanplay(this._onCanplay)},n.offEventListener=function(){this._audio.offError(this._onError),this._audio.offCanplay(this._onCanplay),this._audio.offEnded(this._onEnd)},n.onError=function(i){console.log("-----1---------------minisound-----url:",this.url),console.log(i),this.event("error"),this._audio&&(this._miniSound.dispose(),this.offEventListener(),this._audio=this._miniSound=null)},n.onCanPlay=function(){this._audio&&(this.event("complete"),this.offEventListener(),this._audio.onEnded(this._onEnd),this.isStopped?this.stop():this.play())},n.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(t.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},n.play=function(){this.isStopped=!1,_.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){i.prototype.stop.call(this),this.isStopped=!0,_.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this.offEventListener(),this._miniSound.dispose(),this._miniSound=null,this._audio=null))},n.pause=function(){this.isStopped=!0,this._audio&&this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,_.addChannel(this),this._audio.play())},a(0,n,"startTime",(function(){return this._audio?this._audio.startTime:0}),(function(i){this._audio&&(this._audio.startTime=i)})),a(0,n,"autoplay",(function(){return!!this._audio&&this._audio.autoplay}),(function(i){this._audio&&(this._audio.autoplay=i)})),a(0,n,"duration",(function(){return this._audio?this._audio.duration:0})),a(0,n,"position",(function(){return this._audio?this._audio.currentTime:0})),a(0,n,"loop",(function(){return!!this._audio&&this._audio.loop}),(function(i){this._audio&&(this._audio.loop=i)})),a(0,n,"volume",(function(){return this._audio?this._audio.volume:1}),(function(i){this._audio&&(this._audio.volume=i)})),e.bindToThis=function(i,e){return i.bind(e)},e}(y)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],(function(i,e){"use strict";for(var t in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[t];n&&n.__isclass&&(e[t]=n)}}));