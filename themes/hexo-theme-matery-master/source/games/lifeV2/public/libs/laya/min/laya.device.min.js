!function(e){e.un,e.uns;var t=e.static,n=e.class,i=e.getset,a=(e.__newvec,laya.resource.Bitmap),o=laya.utils.Browser,r=(laya.events.Event,laya.events.EventDispatcher),s=(laya.utils.Handler,laya.maths.Rectangle,laya.renders.Render),l=laya.display.Sprite,c=(laya.display.Stage,laya.resource.Texture),d=laya.utils.Utils,h=laya.webgl.WebGL,u=laya.webgl.WebGLContext;function v(){}n(v,"laya.device.geolocation.Geolocation"),v.getCurrentPosition=function(e,t){v.navigator.geolocation.getCurrentPosition((function(t){v.position.setPosition(t),e.runWith(v.position)}),(function(e){t.runWith(e)}),{enableHighAccuracy:laya.device.geolocation.Geolocation.enableHighAccuracy,timeout:laya.device.geolocation.Geolocation.timeout,maximumAge:laya.device.geolocation.Geolocation.maximumAge})},v.watchPosition=function(e,t){return v.navigator.geolocation.watchPosition((function(t){v.position.setPosition(t),e.runWith(v.position)}),(function(e){t.runWith(e)}),{enableHighAccuracy:v.enableHighAccuracy,timeout:v.timeout,maximumAge:v.maximumAge})},v.clearWatch=function(e){v.navigator.geolocation.clearWatch(e)},v.PERMISSION_DENIED=1,v.POSITION_UNAVAILABLE=2,v.TIMEOUT=3,v.enableHighAccuracy=!1,v.maximumAge=0,t(v,["navigator",function(){return this.navigator=o.window.navigator},"position",function(){return this.position=new m},"supported",function(){return this.supported=!!v.navigator.geolocation},"timeout",function(){return this.timeout=1e10}]);var m=function(){function e(){this.pos=null,this.coords=null}n(e,"laya.device.geolocation.GeolocationInfo");var t=e.prototype;return t.setPosition=function(e){this.pos=e,this.coords=e.coords},i(0,t,"heading",(function(){return this.coords.heading})),i(0,t,"latitude",(function(){return this.coords.latitude})),i(0,t,"altitudeAccuracy",(function(){return this.coords.altitudeAccuracy})),i(0,t,"longitude",(function(){return this.coords.longitude})),i(0,t,"altitude",(function(){return this.coords.altitude})),i(0,t,"accuracy",(function(){return this.coords.accuracy})),i(0,t,"speed",(function(){return this.coords.speed})),i(0,t,"timestamp",(function(){return this.pos.timestamp})),e}(),g=(n(f,"laya.device.media.Media"),f.supported=function(){return!!o.window.navigator.getUserMedia},f.getMedia=function(e,t,n){o.window.navigator.getUserMedia&&o.window.navigator.getUserMedia(e,(function(e){t.runWith(o.window.URL.createObjectURL(e))}),(function(e){n.runWith(e)}))},f.__init$=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia},f);function f(){}var p=(n(y,"laya.device.motion.AccelerationInfo"),y);function y(){this.x=NaN,this.y=NaN,this.z=NaN}var E=(n(L,"laya.device.motion.RotationInfo"),L);function L(){this.absolute=!1,this.alpha=NaN,this.beta=NaN,this.gamma=NaN,this.compassAccuracy=NaN}var w=function(a){function r(e){r.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}n(r,"laya.device.motion.Accelerator",a);var s=r.prototype;return s.on=function(e,t,n,i){return a.prototype.on.call(this,e,t,n,i),o.window.addEventListener("devicemotion",this.onDeviceOrientationChange),this},s.off=function(e,t,n,i){return void 0===i&&(i=!1),this.hasListener(e)||o.window.removeEventListener("devicemotion",this.onDeviceOrientationChange),a.prototype.off.call(this,e,t,n,i)},s.onDeviceOrientationChange=function(e){var t=e.interval;r.acceleration.x=e.acceleration.x,r.acceleration.y=e.acceleration.y,r.acceleration.z=e.acceleration.z,r.accelerationIncludingGravity.x=e.accelerationIncludingGravity.x,r.accelerationIncludingGravity.y=e.accelerationIncludingGravity.y,r.accelerationIncludingGravity.z=e.accelerationIncludingGravity.z,r.rotationRate.alpha=-1*e.rotationRate.gamma,r.rotationRate.beta=-1*e.rotationRate.alpha,r.rotationRate.gamma=e.rotationRate.beta,o.onAndroid?(r.onChrome&&(r.rotationRate.alpha*=180/Math.PI,r.rotationRate.beta*=180/Math.PI,r.rotationRate.gamma*=180/Math.PI),r.acceleration.x*=-1,r.accelerationIncludingGravity.x*=-1):o.onIOS&&(r.acceleration.y*=-1,r.acceleration.z*=-1,r.accelerationIncludingGravity.y*=-1,r.accelerationIncludingGravity.z*=-1,t*=1e3),this.event("change",[r.acceleration,r.accelerationIncludingGravity,r.rotationRate,t])},i(1,r,"instance",(function(){return r._instance=r._instance||new r(0),r._instance}),laya.events.EventDispatcher._$SET_instance),r.getTransformedAcceleration=function(t){return r.transformedAcceleration=r.transformedAcceleration||new p,r.transformedAcceleration.z=t.z,90==o.window.orientation?(r.transformedAcceleration.x=t.y,r.transformedAcceleration.y=-t.x):-90==o.window.orientation?(r.transformedAcceleration.x=-t.y,r.transformedAcceleration.y=t.x):o.window.orientation?180==o.window.orientation&&(r.transformedAcceleration.x=-t.x,r.transformedAcceleration.y=-t.y):(r.transformedAcceleration.x=t.x,r.transformedAcceleration.y=t.y),t=NaN,-90==e.stage.canvasDegree?(t=r.transformedAcceleration.x,r.transformedAcceleration.x=-r.transformedAcceleration.y,r.transformedAcceleration.y=t):90==e.stage.canvasDegree&&(t=r.transformedAcceleration.x,r.transformedAcceleration.x=r.transformedAcceleration.y,r.transformedAcceleration.y=-t),r.transformedAcceleration},r._instance=null,r.transformedAcceleration=null,t(r,["acceleration",function(){return this.acceleration=new p},"accelerationIncludingGravity",function(){return this.accelerationIncludingGravity=new p},"rotationRate",function(){return this.rotationRate=new E},"onChrome",function(){return this.onChrome=-1<o.userAgent.indexOf("Chrome")}]),r}(r),x=(function(e){function a(e){a.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}n(a,"laya.device.motion.Gyroscope",e);var r=a.prototype;r.on=function(t,n,i,a){return e.prototype.on.call(this,t,n,i,a),o.window.addEventListener("deviceorientation",this.onDeviceOrientationChange),this},r.off=function(t,n,i,a){return void 0===a&&(a=!1),this.hasListener(t)||o.window.removeEventListener("deviceorientation",this.onDeviceOrientationChange),e.prototype.off.call(this,t,n,i,a)},r.onDeviceOrientationChange=function(e){a.info.alpha=e.alpha,a.info.beta=e.beta,a.info.gamma=e.gamma,e.webkitCompassHeading&&(a.info.alpha=-1*e.webkitCompassHeading,a.info.compassAccuracy=e.webkitCompassAccuracy),this.event("change",[e.absolute,a.info])},i(1,a,"instance",(function(){return a._instance=a._instance||new a(0),a._instance}),laya.events.EventDispatcher._$SET_instance),a._instance=null,t(a,["info",function(){return this.info=new E}])}(r),function(){function e(){this.throushold=0,this.shakeInterval=0,this.callback=null,this.lastX=NaN,this.lastY=NaN,this.lastZ=NaN,this.lastMillSecond=NaN,e.__super.call(this)}n(e,"laya.device.Shake",r);var t=e.prototype;t.start=function(e,t){this.throushold=e,this.shakeInterval=t,this.lastX=this.lastY=this.lastZ=NaN,w.instance.on("change",this,this.onShake)},t.stop=function(){w.instance.off("change",this,this.onShake)},t.onShake=function(e,t,n,i){if(isNaN(this.lastX))return this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z,void(this.lastMillSecond=o.now());var a=Math.abs(this.lastX-t.x),r=Math.abs(this.lastY-t.y),s=Math.abs(this.lastZ-t.z);this.isShaked(a,r,s)&&o.now()-this.lastMillSecond>this.shakeInterval&&(this.event("change"),this.lastMillSecond=o.now()),this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z},t.isShaked=function(e,t,n){return e>this.throushold&&t>this.throushold||e>this.throushold&&n>this.throushold||t>this.throushold&&n>this.throushold},i(1,e,"instance",(function(){return e._instance=e._instance||new e,e._instance}),laya.events.EventDispatcher._$SET_instance),e._instance=null}(),function(t){function a(e,t){this.htmlVideo=null,this.videoElement=null,this.internalTexture=null,void 0===e&&(e=320),void 0===t&&(t=240),a.__super.call(this),s.isWebGL?this.htmlVideo=new b:this.htmlVideo=new T,this.videoElement=this.htmlVideo.getVideo(),(this.videoElement.layaTarget=this).internalTexture=new c(this.htmlVideo),this.videoElement.addEventListener("abort",a.onAbort),this.videoElement.addEventListener("canplay",a.onCanplay),this.videoElement.addEventListener("canplaythrough",a.onCanplaythrough),this.videoElement.addEventListener("durationchange",a.onDurationchange),this.videoElement.addEventListener("emptied",a.onEmptied),this.videoElement.addEventListener("error",a.onError),this.videoElement.addEventListener("loadeddata",a.onLoadeddata),this.videoElement.addEventListener("loadedmetadata",a.onLoadedmetadata),this.videoElement.addEventListener("loadstart",a.onLoadstart),this.videoElement.addEventListener("pause",a.onPause),this.videoElement.addEventListener("play",a.onPlay),this.videoElement.addEventListener("playing",a.onPlaying),this.videoElement.addEventListener("progress",a.onProgress),this.videoElement.addEventListener("ratechange",a.onRatechange),this.videoElement.addEventListener("seeked",a.onSeeked),this.videoElement.addEventListener("seeking",a.onSeeking),this.videoElement.addEventListener("stalled",a.onStalled),this.videoElement.addEventListener("suspend",a.onSuspend),this.videoElement.addEventListener("timeupdate",a.onTimeupdate),this.videoElement.addEventListener("volumechange",a.onVolumechange),this.videoElement.addEventListener("waiting",a.onWaiting),this.videoElement.addEventListener("ended",this.onPlayComplete.bind(this)),this.size(e,t),o.onMobile&&(this.onDocumentClick=this.onDocumentClick.bind(this),o.document.addEventListener("touchend",this.onDocumentClick))}n(a,"laya.device.media.Video",t);var r=a.prototype;return r.onPlayComplete=function(t){e.timer.clear(this,this.renderCanvas),this.event("ended")},r.load=function(e){0==e.indexOf("blob:")?this.videoElement.src=e:this.htmlVideo.setSource(e,laya.device.media.Video.MP4)},r.play=function(){this.videoElement.play(),e.timer.frameLoop(1,this,this.renderCanvas)},r.pause=function(){this.videoElement.pause(),e.timer.clear(this,this.renderCanvas)},r.reload=function(){this.videoElement.load()},r.canPlayType=function(e){var t;switch(e){case laya.device.media.Video.MP4:t="video/mp4";break;case laya.device.media.Video.OGG:t="video/ogg";break;case laya.device.media.Video.WEBM:t="video/webm"}return this.videoElement.canPlayType(t)},r.renderCanvas=function(){0!==this.readyState&&(s.isWebGL&&this.htmlVideo.updateTexture(),this.graphics.clear(),this.graphics.drawTexture(this.internalTexture,0,0,this.width,this.height))},r.onDocumentClick=function(){this.videoElement.play(),this.videoElement.pause(),o.document.removeEventListener("touchend",this.onDocumentClick)},r.size=function(e,n){return t.prototype.size.call(this,e,n),this.videoElement.width=e/o.pixelRatio,this.paused&&this.renderCanvas(),this},r.destroy=function(e){t.prototype.destroy.call(this,e=void 0===e||e),this.videoElement.removeEventListener("abort",a.onAbort),this.videoElement.removeEventListener("canplay",a.onCanplay),this.videoElement.removeEventListener("canplaythrough",a.onCanplaythrough),this.videoElement.removeEventListener("durationchange",a.onDurationchange),this.videoElement.removeEventListener("emptied",a.onEmptied),this.videoElement.removeEventListener("error",a.onError),this.videoElement.removeEventListener("loadeddata",a.onLoadeddata),this.videoElement.removeEventListener("loadedmetadata",a.onLoadedmetadata),this.videoElement.removeEventListener("loadstart",a.onLoadstart),this.videoElement.removeEventListener("pause",a.onPause),this.videoElement.removeEventListener("play",a.onPlay),this.videoElement.removeEventListener("playing",a.onPlaying),this.videoElement.removeEventListener("progress",a.onProgress),this.videoElement.removeEventListener("ratechange",a.onRatechange),this.videoElement.removeEventListener("seeked",a.onSeeked),this.videoElement.removeEventListener("seeking",a.onSeeking),this.videoElement.removeEventListener("stalled",a.onStalled),this.videoElement.removeEventListener("suspend",a.onSuspend),this.videoElement.removeEventListener("timeupdate",a.onTimeupdate),this.videoElement.removeEventListener("volumechange",a.onVolumechange),this.videoElement.removeEventListener("waiting",a.onWaiting),this.videoElement.removeEventListener("ended",this.onPlayComplete),this.pause(),this.videoElement=null},r.syncVideoPosition=function(){var t=e.stage,n=d.getGlobalPosAndScale(this),i=t._canvasTransform.a,a=t._canvasTransform.d;i=n.x*t.clientScaleX*i+t.offset.x,t=n.y*t.clientScaleY*a+t.offset.y,this.videoElement.style.left=i+"px",this.videoElement.style.top=t+"px",this.videoElement.width=this.width/o.pixelRatio,this.videoElement.height=this.height/o.pixelRatio},i(0,r,"buffered",(function(){return this.videoElement.buffered})),i(0,r,"videoWidth",(function(){return this.videoElement.videoWidth})),i(0,r,"currentSrc",(function(){return this.videoElement.currentSrc})),i(0,r,"currentTime",(function(){return this.videoElement.currentTime}),(function(e){this.videoElement.currentTime=e,this.renderCanvas()})),i(0,r,"ended",(function(){return this.videoElement.ended})),i(0,r,"volume",(function(){return this.videoElement.volume}),(function(e){this.videoElement.volume=e})),i(0,r,"videoHeight",(function(){return this.videoElement.videoHeight})),i(0,r,"readyState",(function(){return this.videoElement.readyState})),i(0,r,"duration",(function(){return this.videoElement.duration})),i(0,r,"error",(function(){return this.videoElement.error})),i(0,r,"loop",(function(){return this.videoElement.loop}),(function(e){this.videoElement.loop=e})),i(0,r,"playbackRate",(function(){return this.videoElement.playbackRate}),(function(e){this.videoElement.playbackRate=e})),i(0,r,"muted",(function(){return this.videoElement.muted}),(function(e){this.videoElement.muted=e})),i(0,r,"paused",(function(){return this.videoElement.paused})),i(0,r,"preload",(function(){return this.videoElement.preload}),(function(e){this.videoElement.preload=e})),i(0,r,"seekable",(function(){return this.videoElement.seekable})),i(0,r,"seeking",(function(){return this.videoElement.seeking})),i(0,r,"height",t.prototype._$get_height,(function(t){e.superSet(l,this,"height",t),this.paused&&this.renderCanvas()})),i(0,r,"width",t.prototype._$get_width,(function(t){this.videoElement.width=this.width/o.pixelRatio,e.superSet(l,this,"width",t),this.paused&&this.renderCanvas()})),a.onAbort=function(e){e.target.layaTarget.event("abort")},a.onCanplay=function(e){e.target.layaTarget.event("canplay")},a.onCanplaythrough=function(e){e.target.layaTarget.event("canplaythrough")},a.onDurationchange=function(e){e.target.layaTarget.event("durationchange")},a.onEmptied=function(e){e.target.layaTarget.event("emptied")},a.onError=function(e){e.target.layaTarget.event("error")},a.onLoadeddata=function(e){e.target.layaTarget.event("loadeddata")},a.onLoadedmetadata=function(e){e.target.layaTarget.event("loadedmetadata")},a.onLoadstart=function(e){e.target.layaTarget.event("loadstart")},a.onPause=function(e){e.target.layaTarget.event("pause")},a.onPlay=function(e){e.target.layaTarget.event("play")},a.onPlaying=function(e){e.target.layaTarget.event("playing")},a.onProgress=function(e){e.target.layaTarget.event("progress")},a.onRatechange=function(e){e.target.layaTarget.event("ratechange")},a.onSeeked=function(e){e.target.layaTarget.event("seeked")},a.onSeeking=function(e){e.target.layaTarget.event("seeking")},a.onStalled=function(e){e.target.layaTarget.event("stalled")},a.onSuspend=function(e){e.target.layaTarget.event("suspend")},a.onTimeupdate=function(e){e.target.layaTarget.event("timeupdate")},a.onVolumechange=function(e){e.target.layaTarget.event("volumechange")},a.onWaiting=function(e){e.target.layaTarget.event("waiting")},a.MP4=1,a.OGG=2,a.CAMERA=4,a.WEBM=8,a.SUPPORT_PROBABLY="probably",a.SUPPORT_MAYBY="maybe",a.SUPPORT_NO="",a}(l)),T=function(){function e(){this.video=null,e.__super.call(this),this._w=1,this._h=1,this.createDomElement()}n(e,"laya.device.media.HtmlVideo",a);var t=e.prototype;return t.createDomElement=function(){var e=this;this._source=this.video=o.createElement("video");var t=this.video.style;t.position="absolute",t.top="0px",t.left="0px",this.video.addEventListener("loadedmetadata",function(){this._w=e.video.videoWidth,this._h=e.video.videoHeight}.bind(this))},t.setSource=function(e,t){for(;this.video.childElementCount;)this.video.firstChild.remove();t&x.MP4&&this.appendSource(e,"video/mp4"),t&x.OGG&&this.appendSource(e+".ogg","video/ogg")},t.appendSource=function(e,t){var n=o.createElement("source");n.src=e,n.type=t,this.video.appendChild(n)},t.getVideo=function(){return this.video},e.create=function(){return new e},e}(),b=(n(_,"laya.device.media.WebGLVideo",T),_.prototype.updateTexture=function(){o.onIPhone||(u.bindTexture(this.gl,3553,this._source),this.gl.texImage2D(3553,0,6407,6407,5121,this.video))},_);function _(){this.gl=null,this.preTarget=null,this.preTexture=null,_.__super.call(this),o.onIPhone||(this.gl=h.mainContext,this._source=this.gl.createTexture(),this.preTarget=u.curBindTexTarget,this.preTexture=u.curBindTexValue,u.bindTexture(this.gl,3553,this._source),this.gl.texParameteri(3553,10242,33071),this.gl.texParameteri(3553,10243,33071),this.gl.texParameteri(3553,10240,9729),this.gl.texParameteri(3553,10241,9729),this.preTarget&&this.preTexture&&u.bindTexture(this.gl,this.preTarget,this.preTexture))}e.__init([g])}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],(function(e,t){"use strict";for(var n in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var i=Laya[n];i&&i.__isclass&&(t[n]=i)}}));